{"version":3,"sources":["app.js","directives/directives.js","controllers/appCtrl.js","controllers/controllers.js","filters/filters.js","services/services.js"],"names":["app","angular","module","document","URL","indexOf","constant","config","$mdThemingProvider","primaryPalette","extendPalette","contrastDefaultColor","contrastDarkColors","contrastLightColors","500","50","100","300","400","accentPalette","200","600","700","definePalette","theme","default","hue-1","hue-2","hue-3","warnPalette","$compileProvider","$logProvider","$animateProvider","debugEnabled","debugInfoEnabled","FacebookProvider","$httpProvider","RestangularProvider","apiBase","setAppId","setBaseUrl","interceptors","push","$q","$location","$localStorage","$rootScope","Auth","request","headers","token","Authorization","response","t","replace","responseError","status","data","error","resetProfile","path","console","log","reject","run","$cordovaSplashscreen","$cordovaKeyboard","$cordovaStatusbar","window","addEventListener","FastClick","body","style","styleHex","hideAccessoryBar","hide","$stateProvider","$urlRouterProvider","$locationProvider","appBase","state","abstract","templateUrl","url","controller","template","resolve","messagingUser","Restangular","$stateParams","d","defer","one","user_id","get","then","r","promise","profile","id","views","","@web.app.dashboard.centered.user","@web.app.dashboard","otherwise","html5Mode","enabled","requireBase","directive","restrict","transclude","PostService","scope","posts","loading","$scope","this","SDeletePost","post_id","post","remove","i","map","x","splice","noPosts","CommentService","UXService","Facebook","$cordovaFacebook","appUrl","$filter","EmojioneService","isCordova","require","link","element","attrs","SuperTPostsCtrl","user","userProfile","CommentsUI","retryButton","actions","App\\Tap","App\\Favorite","App\\Amen","App\\Comment","App\\Post","user_ref_activities","length","interpretation","action","ref_activities","l","a_t","action_type","showMore","less","more","postWordsCount","text","split","emojione","shortnameToImage","all_array","slice","join","optimizedText","post_truncate","toggleMore","originatorEv","openMenu","$mdOpenMenu","ev","prayer","amens_count","taps_count","comments_count","showCommentBox","openCommentBox","getList","comments","addComment","doCommentPost","commentBox","unshift","toast","authenticated","signinModal","deleteComment","comment_id","comment","toggleFavorite","doFavorite","favorited","favorites_count","count","toggleTap","doTap","tapped_into","sayAmen","doSayAmen","amen","shareToFb","options","method","picture","name","caption","description","showDialog","success","ui","deletePost","$timeout","icon","e","elem","$mdSidenav","$mdMedia","$state","AppService","Me","Pusher","NotificationsService","TokenService","location","composingPost","tokHashId","hash_id","showSearch","showSideNav","toggleNav","which","toggle","close","toggleSearchBox","getCategoriesWithCount","cats","categories","logout","redirect","go","menu","title","condition","click","menuAuth","getSearchResultIcon","type","searchIcons","tag","searchRepo","query","search","q","plain","notifications","messages","MessageNotifications","friend_requests","FriendRequestNotifications","general","Notifications","refreshProfile","$document","home","posts_loading","current","loadPosts","load","param","getPosts","err","cat","category","fb_button","getLoginStatus","api","fb_logged_in","fb_name","loginFB","signinFB","UXLoginFB","UXSubmitLogin","loginDetails","submitLogin","signin","$mdDialog","refresh","newUser","signupFb","login","fields","show","alert","parent","querySelector","clickOutsideToClose","ariaLabel","ok","submitForm","signupForm","$valid","signup","me","user_profile","activities","favorites","taps","loadUserProfile","loadUserActivities","all","loadUserFavorites","loadUserTaps","sendFriendRequest","Upload","username","saveAccountInfo","obj","first_name","last_name","section_account","saveAboutInfo","favorite_book","favorite_verse","favorite_parable","denomination","section_about_me","uploadAvatar","file","uploading","upload","dataUrltoBlob","avatar","picFile","dataUrl","result","errorMsg","evt","progress","parseInt","loaded","total","changePassword","password","newPassword","newPassword1","resp","chats","getOtherUserFromSubs","subs","otherUser","UtilityService","inputMessage","chat_id","push_new_message","message","$$phase","$digest","$","animate","scrollTop","scrollHeight","clearNotifications","subscription_succeeded","smartLoad","findHighestID","after","chatChannel","pm","pusher","subscribe","bind","sendMessage","trim","socket_id","connection","$on","event","toState","toParams","fromState","fromParams","unsubscribe","$mdToast","selectedCategories","files","newPost","creating","emojionearea","emojioneArea","autoHideFilters","useSprite","placeholder","container","hideSource","on","getCategories","toggleCatPopup","showSelectCatPopup","catsClick","idx","catsExists","removePicture","uploadImages","finished","doUpload","complete","image_id","failed","Math","min","forEach","composePost","toShort","getText","anonymous","$viewValue","createPost","o","sendPost","p","a","images","setText","id_arr","FriendshipService","types","profiles","notifs","aNotif","content","acceptRequest","deleteRelationship","cancel","answer","res","actives","filePostIn","filter","num","out","round","factory","cordova","urlBase64Decode","str","output","atob","getClaimsFromToken","claims","encoded","JSON","parse","rawToken","service","makeCall","encrypted","authEndpoint","auth","headerAuthBearerRefresh","$window","facebookConnectPlugin","getElementsByClassName","targetEvent","simple","position","hideDelay","firstName","lastName","sex","email","setFullResponse","exp","Date","now","buildAuthProfile","reInitPusher","u","saveToken","doFbLogin","fb_response","json","fb_access_token","authResponse","accessToken","tokenClaims","uid","sub","notif_channel","notifications_subscribe","notifications_unsubscribe","n_chanell","m_notif","f_requests","getIndexById","arr","checkIfCurrentChat","chat","users","initPusher","n","patch","findHighestTimestamp","created_at","userID","imagePathPNG"],"mappings":"AACA,GAAIA,KAAMC,QAAQC,OAAO,WACvB,aACA,6BACA,YACA,aACA,gBACA,YACA,YACA,cACA,WACA,eACA,YACA,iBACA,aACA,aAGyC,MAAtCC,SAASC,IAAIC,QAAS,YAA6D,KAAvCF,SAASC,IAAIC,QAAS,aACrEL,IAAIM,SAAS,UAAW,gDACxBN,IAAIM,SAAS,UAAW,KACxBN,IAAIM,SAAS,SAAU,2CAEvBN,IAAIM,SAAS,SAAU,yCACvBN,IAAIM,SAAS,UAAW,KACxBN,IAAIM,SAAS,UAAW,WAG1BN,IAAIO,QAAA,qBAAO,SAASC,GAClB,GAAIC,GAAiBD,EAAmBE,cAAc,QACpDC,qBAAwB,QACxBC,oBAAuB,OACvBC,qBAAwB,MAAO,OAC/BC,IAAO,SACPC,GAAM,SACNC,IAAO,SACPC,IAAO,SACPC,IAAO,WAELC,EAAgBX,EAAmBE,cAAc,SAEnDC,qBAAwB,QACxBC,oBAAuB,MAAO,OAC9BC,qBAAwB,OACxBC,IAAO,SACPC,GAAM,SACNC,IAAO,SACPI,IAAO,SACPH,IAAO,SACPC,IAAO,SACPG,IAAO,SACPC,IAAO,UAGTd,GAAmBe,cAAc,UAAWd,GAC5CD,EAAmBe,cAAc,SAAUJ,GAE3CX,EAAmBgB,MAAM,WACtBf,eAAe,WACdgB,UAAW,MACXC,QAAS,KACTC,QAAS,MACTC,QAAS,QAEVT,cAAc,UACbM,UAAW,MACXC,QAAS,MACTC,QAAS,QAEVE,YAAY,UAIjB7B,IAAIO,QAAQ,mBAAoB,eAAgB,mBAAoB,SAAUuB,EAAkBC,EAAcC,GAC5GD,EAAaE,cAAa,GAC1BH,EAAiBI,kBAAiB,MAIpClC,IAAIO,QAAA,mBAAA,gBAAA,sBAAA,UAAO,SAAS4B,EAAkBC,EAAeC,EACnDC,GACAH,EAAiBI,SAAS,gBAC1BF,EAAoBG,WAAWF,GAE/BF,EAAcK,aAAaC,MAAM,KAAM,YAAa,gBAClD,SAASC,EAAIC,EAAWC,EAAeC,EAAYC,GACjD,OACEC,QAAW,SAASzC,GAKlB,MAJAA,GAAO0C,QAAU1C,EAAO0C,YACpBJ,EAAcK,QAChB3C,EAAO0C,QAAQE,cAAgB,UAAYN,EAAcK,OAEpD3C,GAET6C,SAAY,SAASA,GACnB,GAAIC,GAAID,EAASH,QAAQ,gBAOzB,OANII,KACFA,EAAEC,QAAQ,UAAW,IACrBT,EAAcK,MAAQG,GAIjBD,GAETG,cAAiB,SAASH,GA0BxB,OAzBwB,MAApBA,EAASI,QAAsC,MAApBJ,EAASI,QAClB,MAApBJ,EAASI,UACkB,iBAAvBJ,EAASK,KAAKC,aACTb,GAAcK,MACrBH,EAAKY,eACLf,EAAUgB,KAAK,YACiB,iBAAvBR,EAASK,KAAKC,aAChBb,GAAcK,MACrBH,EAAKY,eACLf,EAAUgB,KAAK,YACiB,qBAAvBR,EAASK,KAAKC,aAChBb,GAAcK,MACrBH,EAAKY,eACLf,EAAUgB,KAAK,YACiB,sBAAvBR,EAASK,KAAKC,cAChBb,GAAcK,MACrBH,EAAKY,eACLf,EAAUgB,KAAK,YAKjBC,QAAQC,IAAI,8BAGPnB,EAAGoB,OAAOX,WAO3BpD,IAAIgE,KAAK,uBAAwB,mBAAoB,oBAAqB,SAASC,EAAsBC,EAAkBC,GACzHC,OAAOC,iBAAiB,OAAQ,WAC9B,GAAIC,WAAUnE,SAASoE,QACtB,GAEsC,KAAtCpE,SAASC,IAAIC,QAAS,YAA6D,KAAvCF,SAASC,IAAIC,QAAS,aACnEF,SAASkE,iBAAiB,cAAe,WACvCF,EAAkBK,MAAM,GACxBL,EAAkBM,SAAS,WAC3BP,EAAiBQ,kBAAiB,GAClCT,EAAqBU,SAEpB,MAKP3E,IAAIO,QAAA,iBAAA,qBAAA,oBAAA,UAAO,SAASqE,EAAgBC,EAAoBC,EACtDC,GACAH,EACGI,MAAM,OAELC,YAAU,EACVC,YAAa,mBACZF,MAAM,WACPC,YAAU,EACVE,IAAKJ,EACLG,YAAa,uBACZF,MAAM,iBACPG,IAAK,QACLD,YAAa,6BACZF,MAAM,kBACPG,IAAK,SACLC,WAAY,YACZF,YAAa,8BACZF,MAAM,kBACPG,IAAK,SACLC,WAAY,aACZC,SAAU,MACTL,MAAM,mBACPG,IAAK,GACLD,YAAa,+BACZF,MAAM,kBACPG,IAAK,SACLD,YAAa,uCACZF,MAAM,qBACPC,YAAU,EACVE,IAAK,GACLD,YAAa,iCACZF,MAAM,8BACPC,YAAU,EACVE,IAAK,GACLD,YAAa,0CACZF,MAAM,mCACPG,IAAK,OACLD,YAAa,+CACZF,MAAM,4CACPG,IAAK,gBACLD,YAAa,+CACZF,MAAM,8BACPG,IAAK,WACLD,YAAa,0CACZF,MAAM,6BACPG,IAAK,oBACLD,YAAa,uCACbE,WAAY,cACZE,SACEC,eAAA,cAAA,eAAA,KAAe,SAASC,EAAaC,EAAc9C,GACjD,GAAI+C,GAAI/C,EAAGgD,OAKX,OAJAH,GAAYI,IAAI,QAASH,EAAaI,SAASC,MAAMC,KACnD,SAASC,GACPN,EAAEJ,QAAQU,EAAEvC,QAETiC,EAAEO,aAGZjB,MAAM,0BACPG,IAAK,iBACLD,YAAa,sCACZF,MAAM,oCACPG,IAAK,YACLD,YAAa,+CACZF,MAAM,mCACPG,IAAK,WACLG,SACEY,SAAA,eAAA,cAAS,SAAST,EAAcD,GAC9B,MAAOA,GAAYI,IAAI,QAASH,EAAaU,IAAIL,SAGrDM,OACEC,IACEnB,YAAa,gDACbE,WAAY,eAEdkB,oCACEpB,YAAa,sDAGhBF,MAAM,8CACPG,IAAK,cACLD,YAAa,oDACZF,MAAM,6CACPG,IAAK,aACLD,YAAa,mDACZF,MAAM,wCACPG,IAAK,QACLD,YAAa,8CACZF,MAAM,wCACPG,IAAK,QACLiB,OACEG,sBACErB,YAAa,gDAMrBL,EAAmB2B,UAAUzB,EAAU,QAEI,KAAtC5E,SAASC,IAAIC,QAAS,YAA6D,KAAvCF,SAASC,IAAIC,QAAS,aAGrEyE,EAAkB2B,WAChBC,SAAS,EACTC,aAAa;ACrQnB3G,IAAI4G,UAAU,eAAgB,WAE1B,OACIC,SAAU,IACVC,YAAY,EACZxD,SAAS,EACT4B,YAAa,qCAIrBlF,IAAI4G,UAAU,gBAAiB,WAC3B,OACIC,SAAU,IACVC,YAAY,EACZxD,SAAS,EACT4B,YAAa,sCAIrBlF,IAAI4G,UAAU,aAAc,WACxB,OACIC,SAAU,IACVC,YAAY,EACZxD,SAAS,EACT4B,YAAa,kCAIrBlF,IAAI4G,UAAU,cAAe,WACzB,OACIC,SAAU,IACVC,YAAY,EACZxD,SAAS,EACT4B,YAAa,oCAIrBlF,IAAI4G,UAAU,qBAAsB,WAChC,OACIC,SAAU,IACVC,YAAY,EACZxD,SAAS,EACT4B,YAAa,6CAIrBlF,IAAI4G,UAAU,gBAAiB,cAAe,SAASG,GACnD,OACIF,SAAU,IACVC,YAAY,EACZxD,SAAS,EACT4B,YAAa,qCACb8B,OACIC,MAAO,gBACPC,QAAS,YAEb9B,YAAA,SAAY,SAAS+B,GAGjBC,KAAKC,YAAc,SAASC,GACxBP,EAAYQ,KAAKD,GAASE,SAASzB,KAAK,SAASC,GAC7C,GAAIyB,GAAIN,EAAOF,MAAMS,IAAI,SAASC,GAC1B,MAAOA,GAAExB,KAEZ9F,QAAQiH,EAGbH,GAAOF,MAAMW,OAAOH,EAAG,MAM/BN,EAAOU,SAAU,QAM7B7H,IAAI4G,UAAU,eAAgB,cAAe,iBAAkB,OAAQ,YAAa,WAAY,mBAAoB,SAAU,UAAW,kBAAmB,YAAa,SAASG,EAAae,EAAgB/E,EAAMgF,EAAWC,EAAUC,EAAkBC,EAAQC,EAASC,EAAiBC,GAC1R,OACIxB,SAAU,IACVyB,QAAS,iBACTtB,OACIO,KAAM,gBAEVrC,YAAa,oCACbqD,KAAM,SAASvB,EAAOwB,EAASC,EAAOC,GAClC1B,EAAM2B,KAAO5F,EAAK6F,YAClB5B,EAAM6B,YACF3B,SAAS,EACT4B,aAAa,EAGjB,IAAIC,IACAC,YAAa,cAAe,aAC5BC,iBAAkB,YAAa,aAC/BC,aAAc,YAAa,gBAC3BC,gBAAiB,YAAa,gBAC9BC,aAAc,SAAU,eAG5B,IAAIpC,EAAMO,KAAK8B,qBACPrC,EAAMO,KAAK8B,oBAAoBC,OAAS,EAAG,CAC3CC,eAAiB,GACjB9B,EAAI,CACJ,IAAI+B,GACAC,EAAiBzC,EAAMO,KAAK8B,mBAGhC,IAFAK,EAAI1C,EAAMO,KAAK8B,oBAAoBC,OAE1B,GAALI,EACAC,IAAMF,EAAe,GAAGG,YACxBL,gBAAkB,IACdR,EAAQY,KAAK,GACb,IAAMZ,EAAQY,KAAK,OACpB,IAAS,GAALD,EAEP,IAAKF,IAAUC,GACXhC,IACAkC,IAAMF,EAAeD,GAAQI,YAEzBnC,GAAKiC,EAAI,IACTH,gBAAkB,IAAMR,EAAQY,KAAK,IAGrClC,GAAKiC,IACLH,gBAAkB,QAAUR,EAAQY,KAAK,GAAK,IAAMZ,EAAQY,KAAK,QAGtE,IAAID,EAAI,EACX,IAAKF,IAAUC,GACXhC,IACAkC,IAAMF,EAAeD,GAAQI,YACzBnC,GAAKiC,GAAKA,EAAI,GACdH,gBAAkB,IAAMR,EAAQY,KAAK,GAC9BlC,GAAKiC,EAAI,EAChBH,gBAAkB,KAAOR,EAAQY,KAAK,GAC/BD,GAAKjC,IACZ8B,gBAAkB,QAAUR,EAAQY,KAAK,GAAK,IAAMZ,EAAQY,KAAK,GAK7E3C,GAAMuC,eAAiBA,eAK/BvC,EAAM6C,UAAW,CACjB,IAAIC,GAAMC,EACNC,EAAiBhD,EAAMO,KAAK0C,KAAKC,MAAM,KAAKZ,MAEhD,IADAS,EAAO3B,EAAgB+B,SAASC,iBAAiBpD,EAAMO,KAAK0C,MACzDD,EAAiB,GAAG,CACrB,GAAIK,GAAYrD,EAAMO,KAAK0C,KAAKC,MAAM,IACtCJ,GAAOO,EAAUC,MAAM,EAAG,IAAIC,KAAK,KAAO,WAC1CT,EAAO1B,EAAgB+B,SAASC,iBAAiBN,GACjD9C,EAAMwD,cAAgBV,EACtB9C,EAAMyD,eAAgB,MAEtBzD,GAAMwD,cAAgBT,CAGxB/C,GAAM0D,WAAa,WACd1D,EAAM6C,SACP7C,EAAMwD,cAAgBV,EAEtB9C,EAAMwD,cAAgBT,EAExB/C,EAAM6C,UAAY7C,EAAM6C,SAI1B,IAAIc,EACJ3D,GAAM4D,SAAW,SAASC,EAAaC,GACnCH,EAAeG,EACfD,EAAYC,IAGb9D,EAAMO,KAAKwD,SACZ/D,EAAMgE,YAAc7C,EAAQ,iBAAiBnB,EAAMO,KAAKyD,cAE1DhE,EAAMiE,WAAa9C,EAAQ,iBAAiBnB,EAAMO,KAAK0D,YACvDjE,EAAMkE,eAAiB/C,EAAQ,iBAAiBnB,EAAMO,KAAK2D,gBAE3DlE,EAAMmE,gBAAiB,EACvBnE,EAAMoE,eAAiB,WAEnBpE,EAAM6B,WAAW3B,SAAU,EAC3BF,EAAM6B,WAAWC,aAAc,EAC/B/B,EAAYQ,KAAKP,EAAMO,KAAKpB,IAAIkF,QAAQ,YAAYtF,KAAK,SAASC,GAE9DgB,EAAMO,KAAK+D,SAAWtF,EAAEvC,KACxBuD,EAAM6B,WAAW3B,SAAU,GAC5B,SAASlB,GACRgB,EAAM6B,WAAWC,aAAc,EAC/B9B,EAAM6B,WAAW3B,SAAU,IAG/BF,EAAMmE,gBAAiB,GAG3BnE,EAAMuE,WAAa,SAAST,GACxB,GAAIU,GAAgB,WAEZxE,EAAMyE,YACN1E,EAAYQ,KAAKP,EAAMO,KAAKpB,IAAIoB,KAAK,YACjC0C,KAAMjD,EAAMyE,aACb1F,KAAK,SAASC,GACbgB,EAAMO,KAAK2D,iBACXlE,EAAMkE,eAAiB/C,EAAQ,iBAAiBnB,EAAMO,KAAK2D,gBAC3DlE,EAAMO,KAAK+D,SAASI,QAAQ1F,EAAEvC,MAC9BuD,EAAMyE,WAAa,IACpB,SAASzF,GACR+B,EAAU4D,MAAM,yEAIxB5I,GAAK6F,YAAYgD,cACjBJ,IAEAzD,EAAU8D,YAAYf,GAAI/E,KAAK,WAC3ByF,KACD,WACCzD,EAAU4D,MAAM,mEAK5B3E,EAAM8E,cAAgB,SAASC,GAC3B,GAAIC,GAAUlE,EAAekE,QAAQD,EACrCC,GAAQxE,SAASzB,KAAK,SAASC,GAE3B,GAAIyB,GAAIT,EAAMO,KAAK+D,SAAS5D,IAAI,SAASC,GACjC,MAAOA,GAAExB,KAEZ9F,QAAQ0L,EAGb/E,GAAMO,KAAK+D,SAAS1D,OAAOH,EAAG,GAC9BT,EAAMO,KAAK2D,iBACXlE,EAAMkE,eAAiB/C,EAAQ,iBAAiBnB,EAAMO,KAAK2D,mBAOnElE,EAAMiF,eAAiB,SAASnB,GAE5B,GAAIoB,GAAa,WACTlF,EAAMO,KAAK4E,WACXnF,EAAMO,KAAK4E,WAAY,EACvBnF,EAAMO,KAAK6E,kBACXrF,EAAYQ,KAAKP,EAAMO,KAAKpB,IAAIP,IAAI,aAAa4B,SAASzB,KAAK,SAASC,GAEpEgB,EAAMO,KAAK4E,UAAYnG,EAAEvC,KAAKD,OAC9BwD,EAAMO,KAAK6E,gBAAkBpG,EAAEvC,KAAK4I,UAGxCrF,EAAMO,KAAK4E,WAAY,EACvBnF,EAAMO,KAAK6E,kBACXrF,EAAYQ,KAAKP,EAAMO,KAAKpB,IAAIP,IAAI,aAAa2B,OAAOxB,KAAK,SAASC,GAElEgB,EAAMO,KAAK4E,UAAYnG,EAAEvC,KAAKD,OAC9BwD,EAAMO,KAAK6E,gBAAkBpG,EAAEvC,KAAK4I,SAI5CtJ,GAAK6F,YAAYgD,cACjBM,IAEAnE,EAAU8D,YAAYf,GAAI/E,KAAK,WAC3BmG,OAOZlF,EAAMsF,UAAY,SAASxB,GAEvB,GAAIyB,GAAQ,WACJvF,EAAMO,KAAKiF,aACXxF,EAAMO,KAAKiF,aAAc,EACzBxF,EAAMO,KAAK0D,aACXlE,EAAYQ,KAAKP,EAAMO,KAAKpB,IAAIP,IAAI,QAAQ4B,SAASzB,KAAK,SAASC,GAE/DgB,EAAMO,KAAKiF,YAAcxG,EAAEvC,KAAKD,OAChCwD,EAAMO,KAAK0D,WAAajF,EAAEvC,KAAK4I,MAC/BrF,EAAMiE,WAAa9C,EAAQ,iBAAiBnB,EAAMO,KAAK0D,gBAG3DjE,EAAMO,KAAKiF,aAAc,EACzBxF,EAAMO,KAAK0D,aACXlE,EAAYQ,KAAKP,EAAMO,KAAKpB,IAAIP,IAAI,QAAQ2B,OAAOxB,KAAK,SAASC,GAE7DgB,EAAMO,KAAKiF,YAAcxG,EAAEvC,KAAKD,OAChCwD,EAAMO,KAAK0D,WAAajF,EAAEvC,KAAK4I,MAC/BrF,EAAMiE,WAAa9C,EAAQ,iBAAiBnB,EAAMO,KAAK0D,eAK/DlI,GAAK6F,YAAYgD,cACjBW,IAEAxE,EAAU8D,YAAYf,GAAI/E,KAAK,WAC3BwG,OAMZvF,EAAMyF,QAAU,SAAS3B,GACrB,GAAI4B,GAAY,WAEZ,MAAG1F,GAAMO,KAAKoF,QAAS,MACnB5E,GAAU4D,MAAM,4CAIpB3E,EAAMO,KAAKoF,MAAO,EAClB3F,EAAMO,KAAKyD,kBACXjE,GAAYQ,KAAKP,EAAMO,KAAKpB,IAAIP,IAAI,SAAS2B,OAAOxB,KAAK,SAASC,GAC9DgB,EAAMO,KAAKoF,KAAO3G,EAAEvC,KAAKD,OACzBwD,EAAMO,KAAKyD,YAAchF,EAAEvC,KAAK4I,MAChCrF,EAAMgE,YAAc7C,EAAQ,iBAAiBnB,EAAMO,KAAKyD,gBAI5DjI,GAAK6F,YAAYgD,cACjBc,IAEA3E,EAAU8D,YAAYf,GAAI/E,KAAK,WAC3B2G,OAMZ1F,EAAM4F,UAAY,WAChB,GAAIC,IACFC,OAAQ,OACRvE,KAAML,EACN6E,QAAS7E,EAAS,qCAClB8E,KAAM,UACNC,QAAS,yBACTC,YAAalG,EAAMO,KAAK0C,KAAO,sGAE9B5B,GACDJ,EAAiBkF,WAAWN,GACzB9G,KAAK,SAASqH,KAEZ,SAAU1J,MAEfsE,EAASqF,GAAGR,EAAS,SAASzJ,OAKlC4D,EAAMsG,WAAa,WAEf5E,EAAgBrB,YAAYL,EAAMO,KAAKpB,UAOvDnG,IAAI4G,UAAU,UAAW,WAAY,SAAS2G,GAC1C,OACI1G,SAAU,IACVG,OACIwG,KAAM,KAEVlK,SAAS,EACTiF,KAAM,SAASvB,EAAOyG,EAAGhF,KAGzBpD,SAAU,yCAIlBrF,IAAI4G,UAAU,mBAAA,WAAmB,SAAS2G,GACtC,OACI1G,SAAU,IACV3B,YAAa,oCACbqD,KAAM,SAASvB,EAAO0G,EAAMjF;ACnYpCzI,IAAIoF,WAAW,WAAA,aAAA,SAAA,aAAA,WAAA,YAAA,SAAA,KAAA,aAAA,OAAA,KAAA,UAAA,UAAA,SAAA,eAAA,uBAAA,eAAA,WAAW,SAAStC,EAAYqE,EAAQwG,EAAYC,EACjEhL,EAAWiL,EAAQlL,EAAImL,EAAY/K,EAAMgL,EAAIhJ,EAASoD,EAAS6F,EAAQvI,EAAcwI,EAAsBC,EAAcX,GACzHpG,EAAOgH,SAAWvL,EAClBuE,EAAOwB,KAAO5F,EAAK6F,YACnBzB,EAAOiH,eAAgB,EACvBjH,EAAOkH,UAAYH,EAAahL,QAAQoL,QAGxCnH,EAAOkG,IACLkB,YAAY,EACZC,YAAaX,EACbY,UAAW,SAAUC,GACN,SAAVA,GACDf,EAAWe,GAAOC,SAClBhB,EAAW,SAASiB,UAEpBjB,EAAWe,GAAOC,SAClBhB,EAAW,QAAQiB,UAIvBC,gBAAiB,WACf1H,EAAOkG,GAAGkB,YAAcpH,EAAOkG,GAAGkB,aAQtCT,EAAWgB,yBAAyB/I,KAAK,SAASgJ,GAEhD,IAAI,GADArF,GAAIqF,EAAKtL,KAAK6F,OACV7B,EAAI,EAAOiC,EAAJjC,EAAOA,IACpBsH,EAAKtL,KAAKgE,GAAG4E,MAAQlE,EAAQ,iBAAiB4G,EAAKtL,KAAKgE,GAAG4E,MAE7DlF,GAAO6H,WAAaD,EAAKtL,MAI3B,IAAIkH,EACJxD,GAAOyD,SAAW,SAASC,EAAaC,GACtCH,EAAeG,EACfD,EAAYC,IAId3D,EAAO8H,OAAS,WACdlM,EAAKkM,UAKP9H,EAAO+H,SAAW,SAASlK,GACzB6I,EAAOsB,GAAGnK,IAGZmC,EAAOiI,OACL7G,KAAM,GACNvD,MAAO,kCACPqK,MAAO,QACP7B,KAAM,OACN8B,WAAW,EACXC,MAAO,KAGTpI,EAAOqI,WACLjH,KAAM,UACNvD,MAAO,uEACPqK,MAAO,UACP7B,KAAM,UACN8B,UAAW,qBACX9F,OAAQ,OAERjB,KAAM,GACNvD,MAAO,6BACPqK,MAAO,WACP7B,KAAM,uBACN8B,UAAW,qBACXC,MAAO,KAEPhH,KAAM,GACNvD,MAAO,iFACPqK,MAAO,aACP7B,KAAM,OACN8B,UAAW,qBACX9F,OAAQ,OAERjB,KAAM,GACNvD,MAAO,4EACPqK,MAAO,cACP7B,KAAM,WACN8B,UAAW,qBACX9F,OAAQ,OAGVrC,EAAOsI,oBAAsB,SAASC,GAEpC,MAAOlC,MAAKkC,IAGdvI,EAAOwI,aACLC,IAAO,QACPjH,KAAQ,MAGVxB,EAAO0I,WAAa,SAASC,GAC3B,GAAIpK,GAAI/C,EAAGgD,OAWX,OAVAmI,GAAWiC,OAAO1E,SAChB2E,EAAGF,IACF/J,KAAK,SAAS3C,GACfsC,EAAEJ,QAAQlC,EAASK,KAAKwM,UAGvB,WACDvK,EAAE3B,WAGG2B,EAAEO,SAGXkB,EAAOnH,KACLkQ,eACEC,SAAUlC,EAAqBmC,qBAC/BC,gBAAiBpC,EAAqBqC,2BACtCC,QAAStC,EAAqBuC,eAEhCL,UACED,cAAejC,EAAqBmC;AC/H1CpQ,IAAIoF,WAAW,eAAgB,OAAQ,SAAU,SAASrC,EAAM8K,GAC9D9K,EAAK0N,iBAAiB1K,KAAK,WACrBhD,EAAK6F,YAAYgD,iBAAkB,GACrCiC,EAAOsB,GAAG,wCAOhBnP,IAAIoF,WAAW,aAAc,aAAc,KAAM,SAAU,SACzD,eAAgB,cAAe,YAAa,YAC5C,SAAS0I,EAAYC,EAAI5G,EAAQ0G,EAAQpI,EAAcD,EACrDuC,EAAW2I,GAkBT,GAhBAvJ,EAAOwJ,MACL1J,SACA2J,eAAe,GAGU,0BAAvB/C,EAAOgD,QAAQ7D,OACjB7F,EAAOwJ,KAAKC,eAAgB,EAE5BpL,EAAYI,IAAI,QAASH,EAAa6I,SAASxI,MAAMC,KACnD,SAASC,GACPmB,EAAOwJ,KAAK1J,OAASjB,EAAEvC,MACvB0D,EAAOwJ,KAAKC,eAAgB,KAKP,mCAAvB/C,EAAOgD,QAAQ7D,QAAuE,CACxF,GAAI8D,GAAY,WAad,QAASC,GAAKC,GAEZlD,EAAWmD,SAAS5F,QAAQ2F,GAAOjL,KAAK,SAASC,GAE/CmB,EAAOwJ,KAAK1J,MAAQjB,EAAEvC,KACtBqK,EAAW9N,IAAIiH,MAAQjB,EAAEvC,KAMzB0D,EAAOwJ,KAAKC,eAAgB,GAE3B,SAASM,GACV/J,EAAOwJ,KAAKC,eAAgB,EAE5B7I,EAAU4D,MAAM,uBA3BpBxE,EAAOwJ,KAAKC,eAAgB,EAG1BG,EADEtL,EAAa0L,KAEbC,SAAU3L,EAAa0L,SA4B7BL,SAOR9Q,IAAIoF,WAAW,aAAc,SAAU,YAAa,WAAY,KAAM,SACpE,OAAQ,KAAM,UACd,SAAS+B,EAAQY,EAAWC,EAAUrF,EAAIkL,EAAQ9K,EAAMgL,EAAIhJ,GAEtDhC,EAAK6F,YAAYgD,iBAAkB,GACrCiC,EAAOsB,GAAG,mCAGZhI,EAAOkK,UAAY,sBAEnBrJ,EAASsJ,eAAe,SAAStL,GAEd,cAAbA,EAAExC,OAEJwE,EAASuJ,IAAI,MAAO,SAASvL,GAC3BmB,EAAOqK,cAAe,EACtBrK,EAAOsK,QAAUzL,EAAEgH,KACnB7F,EAAOkK,UAAY,eAAiBlK,EAAOsK,WAK7CtK,EAAOqK,cAAe,EACtBrK,EAAOsK,QAAU,OACjBtK,EAAOkK,UAAY,yBAIvBlK,EAAOuK,QAAU,WACf3O,EAAK4O,WAAW5L,KAAK,WACnB8H,EAAOsB,GAAG,oCACT,SAASnJ,GACV+B,EAAU4D,MAAM3F,EAAEvC,KAAKC,UAI3ByD,EAAOyK,UAAY,WACjB7J,EAAU6J,aAGZzK,EAAO0K,cAAgB,WACrB9J,EAAU8J,cAAc1K,EAAO2K,cAiBjC3K,GAAO4K,YAAc,WACnBhP,EAAKiP,OAAO7K,EAAO2K,cAAc/L,KAAK,SAASC,GAE7C6H,EAAOsB,GAAG,oCAGT,SAAS+B,GACVnJ,EAAU4D,MAAM,oCAOxB3L,IAAIoF,WAAW,cAAe,SAAU,WAAY,OAAQ,YAC1D,YAAa,SACb,SAAS+B,EAAQa,EAAUjF,EAAMH,EAAWqP,EAAWpE,GACrD,GAAIqE,EAEJ/K,GAAOgL,WACPhL,EAAOiL,SAAW,WAChBpK,EAASqK,QAAQtM,KAAK,WACpBmM,OAIJA,EAAU,WACRlK,EAASuJ,IAAI,OACXe,OAAQ,kCACPvM,KACD,SAAS3C,GACP4E,EAASiH,UAOX,SAASiC,GACPe,EAAUM,KACRN,EAAUO,QACTC,OAAOxS,QAAQuI,QAAQrI,SAASuS,cAAc,UAC9CC,qBAAoB,GACpBtD,MAAM,iBAENuD,UAAU,gBACVC,GAAG,aAQZ1L,EAAO2L,WAAa,WAGd3L,EAAO4L,WAAWC,QACpBjQ,EAAKkQ,OAAO9L,EAAOgL,SAASpM,KAC1B,SAASC,GAEP6H,EAAOsB,GAAG,oCAGZ,SAASnJ,UASnBhG,IAAIoF,WAAW,cAAe,SAAU,OAAQ,KAAM,SAAS+B,EAAQpE,EAAMgL,GAC3EhL,EAAKkM,SAELpL,QAAQC,IAAI,aAGd9D,IAAIoF,WAAW,eAAgB,cAAe,SAAU,eACtD,SAAU,OACV,SAASI,EAAa2B,EAAQ1B,EAAcoI,EAAQ9K,GAElDoE,EAAO+L,GAAKnQ,EAAK6F,WACjB,IAAIuK,GAAe3N,EAAYI,IAAI,QAASH,EAAaU,GAEzDgB,GAAOwB,MACLzC,WACAkN,YAAanM,SAAUC,SAAS,GAChCmM,WAAYpM,SAAUC,SAAS,GAC/BoM,MAAOrM,SAAUC,SAAS,IAG5BC,EAAOoM,gBAAkB,WACvB/N,EAAYI,IAAI,QAASH,EAAaU,IAAIL,KACtCI,SAAS,IACVH,KAAK,SAASC,GACfmB,EAAOgM,aAAenN,EAAEvC,QAI5B0D,EAAOqM,mBAAqB,WAC1BrM,EAAOwB,KAAKyK,WAAWlM,SAAU,EACjCiM,EAAaM,IAAI,cAAcpI,UAAUtF,KAAK,SAASC,GACrDmB,EAAOwB,KAAKyK,WAAWnM,MAAQjB,EAAEvC,KACjC0D,EAAOwB,KAAKyK,WAAWlM,SAAU,KAIrCC,EAAOuM,kBAAoB,WACzBvM,EAAOwB,KAAK0K,UAAUnM,SAAU,EAEhCiM,EAAaM,IAAI,aAAapI,UAAUtF,KAAK,SAASC,GACpDmB,EAAOwB,KAAK0K,UAAUpM,MAAQjB,EAAEvC,KAChC0D,EAAOwB,KAAK0K,UAAUnM,SAAU,KAKpCC,EAAOwM,aAAe,WACpBxM,EAAOwB,KAAK2K,KAAKpM,SAAU,EAE3BiM,EAAaM,IAAI,QAAQpI,UAAUtF,KAAK,SAASC,GAC/CmB,EAAOwB,KAAK2K,KAAKrM,MAAQjB,EAAEvC,KAC3B0D,EAAOwB,KAAK2K,KAAKpM,SAAU,KAK/BC,EAAOyM,kBAAoB,SAASzN,GAClCX,EAAYI,IAAI,MAAM6N,IAAI,WAAWlM,MAAM1B,QAASM,IAItD,IAAI4K,GAAO,WAGT,OAFA5J,EAAOoM,kBAEC1F,EAAOgD,QAAQ7D,MACrB,IAAK,mCACH7F,EAAOuM,mBACP,MACF,KAAK,8BACHvM,EAAOwM,cACP,MACF,KAAK,oCACHxM,EAAOqM,oBACP,MACF,SACErM,EAAOqM,sBAKbzC,QAKJ/Q,IAAIoF,WAAW,mBAAoB,cAAe,SAAU,eAC1D,SAAU,SAAU,OAAQ,YAAa,UACzC,SAASI,EAAa2B,EAAQ1B,EAAcoI,EAAQgG,EAAQ9Q,EAC1DgF,EAAWzF,GAEXkD,EAAYI,IAAI,MAAME,KACpBI,SAAW,IACVH,KACD,SAASC,GACPmB,EAAOgM,aAAenN,EAAEvC,OAG5B0D,EAAOwB,KAAO5F,EAAK6F,YAEb7F,EAAK6F,YAAY0F,SAAW7I,EAAaU,IAAMpD,EAAK6F,YAAYkL,UAClErO,EAAaU,KACftC,QAAQC,IAAI2B,GACZoI,EAAOsB,GAAG,oCAGZhI,EAAO4M,gBAAkB,SAASC,GAChCxO,EAAYI,IAAI,MAAM2B,KACpB,UAAWyM,GAAKjO,KAAK,SAASC,GAC9BjD,EAAK6F,YAAYqL,WAAaD,EAAIC,WAClClR,EAAK6F,YAAYsL,UAAYF,EAAIE,UACjCnR,EAAK6F,YAAYkL,SAAWE,EAAIF,SAEhC3M,EAAOgN,iBAAkB,KAK7BhN,EAAOiN,cAAgB,SAASJ,GAC9BxO,EAAYI,IAAI,MAAM2B,KACpB,UAAWyM,GACbjR,EAAK6F,YAAYuF,SAAW6F,EAAI7F,SACA,OAA7BpL,EAAK6F,YAAY1C,UAClBnD,EAAK6F,YAAY1C,YAEnBnD,EAAK6F,YAAY1C,QAAQmO,cAAgBL,EAAIK,cAC7CtR,EAAK6F,YAAY1C,QAAQoO,eAAiBN,EAAIM,eAC9CvR,EAAK6F,YAAY1C,QAAQqO,iBAAmBP,EAAIO,iBAChDxR,EAAK6F,YAAY1C,QAAQsO,aAAeR,EAAIQ,aAE5CrN,EAAOsN,kBAAmB,GAG5BtN,EAAOuN,aAAe,SAASC,GAC7BxN,EAAOyN,WAAY,EAEnBf,EAAOgB,QACL1P,IAAK7C,EAAU,qBACfmB,MACEkR,KAAMd,EAAOiB,cAAcH,MAE5B5O,KAAK,SAASC,GACfjD,EAAK6F,YAAYmM,OAAS/O,EAAEvC,KAAK0B,IACjC4C,EAAU4D,MAAM,8CAEf,WAED5D,EAAU4D,MAAM,gDAXlBkI,WAYW,WACT1M,EAAOyN,WAAY,EACnBzN,EAAO6N,QAAU,MAIrB7N,EAAO0N,OAAS,SAASI,GACvBpR,QAAQC,IAAI,GACZ+P,EAAOgB,QACL1P,IAAK,0DACL1B,MACEkR,KAAMd,EAAOiB,cAAcG,MAE5BlP,KAAK,SAAS3C,GACfmK,SAAS,WACPpG,EAAO+N,OAAS9R,EAASK,QAE1B,SAASL,GACNA,EAASI,OAAS,IAAG2D,EAAOgO,SAAW/R,EAASI,OAClD,KAAOJ,EAASK,OACjB,SAAS2R,GACVjO,EAAOkO,SAAWC,SAAS,IAAQF,EAAIG,OAASH,EAAII,UAIxDrO,EAAOsO,eAAiB,WAClBtO,EAAOuO,SAASC,aAClBxO,EAAOuO,SAASE,cAAgBzO,EAAOuO,SAASC,cAAgBxO,EAAOuO,SAASE,aAChFpQ,EAAYI,IAAI,MAAM2B,KAAK,WACzBJ,EAAOuO,UAAU3P,KAAK,SAAS8P,GACZ,KAAfA,EAAKrS,QACPuE,EAAU4D,MAAM,kCAEjB,SAASkK,GACV9N,EAAU4D,MAAM,uBAGlB5D,EAAU4D,MAAM,kCAOxB3L,IAAIoF,WAAW,gBAAiB,SAAU,SAAU,eAAgB,cAAe,OAAS,SAAU,SAAS+B,EAAQ0G,EAAQpI,EAAcD,EAAazC,EAAMiL,GAC9J7G,EAAO2O,SAEPtQ,EAAYiO,IAAI,MAAMA,IAAI,YAAYpI,UAAUtF,KAC9C,SAASC,GAcP,IAAI,GAZA8P,GAAQ9P,EAAEvC,KACVsS,EAAuB,SAASC,GAGlC,IAAI,GAFA3J,GAAS2J,EAAK1M,OAEV7B,EAAI,EAAO4E,EAAJ5E,EAAWA,IACxB,GAAGuO,EAAKvO,GAAG5B,SAAW9C,EAAK6F,YAAYzC,GACrC,MAAO6P,GAAKvO,GAAGkB,MAKjB0D,EAAQrG,EAAEvC,KAAK6F,OACX7B,EAAI,EAAO4E,EAAJ5E,EAAWA,IACxBqO,EAAMrO,GAAGwO,UAAYF,EAAqB/P,EAAEvC,KAAKgE,GAAGuO,KAGtD7O,GAAO2O,MAAQA,GACf,SAAS9P,SAOfhG,IAAIoF,WAAW,eAAgB,SAAU,aAAc,gBAAiB,cAAe,OAAQ,eAAgB,SAAU,SAAU,uBAAwB,iBAAkB,SAAS+B,EAAQrE,EAAYyC,EAAeC,EAAazC,EAAM0C,EAAcoI,EAAQG,EAAQC,EAAsBiI,GAC9R/O,EAAOgJ,YACPhJ,EAAOgP,aAAe,GACtBhP,EAAO5B,cAAgBA,CACvB,IACI6Q,GAAU,IAEV3Q,GAAaI,SACfgI,EAAOsB,GAAG,kCAGZ,IAAIkH,GAAmB,SAASC,GAC9BnP,EAAOgJ,SAASzN,KAAK4T,GAEjBnP,EAAOoP,SACTpP,EAAOqP,UAGTC,EAAE,uBAAuBC,SACrBC,UAAWF,EAAE,uBAAuB,GAAGG,aAAe,KACvD,KAEH3I,EAAqB4I,mBAAmBT,IAGtCU,EAAyB,SAASR,GAEpCS,EAAU5P,EAAOgJ,WAGf4G,EAAY,SAAS5G,GACvB,GAAIhK,GAAK+P,EAAec,cAAc7G,EAGtC3K,GAAYiO,IAAI,MAAMA,IAAI,YAAY7N,IAAIH,EAAaI,SAASC,KAC9DmR,MAAO9Q,IACNJ,KACD,SAASC,GAEP,GAAIqG,GAAQrG,EAAEvC,KAAK6F,MACnB,IAAG+C,EAAM,CACP,IAAI,GAAI5E,GAAI,EAAO4E,EAAJ5E,EAAWA,IACxBN,EAAOgJ,SAASzN,KAAKsD,EAAEvC,KAAKgE,GAE9BwG,GAAqB4I,mBAAmBT,GAG1CK,EAAE,uBAAuBC,SACrBC,UAAWF,EAAE,uBAAuB,GAAGG,aAAe,KACvD,IAEH,SAAS5Q,MAMfR,GAAYiO,IAAI,MAAMA,IAAI,YAAY7N,IAAIH,EAAaI,SAASwF,UAAUtF,KACxE,SAASC,GAEPoQ,EAAUpQ,EAAE/C,QAAQ,aACpBiU,YAAc,mBAAqBd,EACnCjP,EAAOgJ,SAAWnK,EAAEvC,KACjBuC,EAAEsD,QACH2E,EAAqB4I,mBAAmBT,EAE1C,IAAIe,GAAKnJ,EAAOoJ,OAAOC,UAAUH,YAEjCC,GAAGG,KAAK,cAAejB,GACvBc,EAAGG,KAAK,gCAAiCR,GAEzCL,EAAE,uBAAuBC,SACrBC,UAAWF,EAAE,uBAAuB,GAAGG,aAAe,KACvD,IAEH,SAAS5Q,MAIbmB,EAAOoQ,YAAc,WACdpQ,EAAOgP,aAAaqB,QACrBhS,EAAYiO,IAAI,SAAS7N,IAAIH,EAAaI,SAAS4N,IAAI,YAAYlM,MACjE+O,QAASnP,EAAOgP,aAChBsB,UAAWzJ,EAAOoJ,OAAOM,WAAWD,YACnC1R,KAAK,SAASC,GACfmB,EAAOgJ,SAASzN,KAAKsD,EAAEvC,MACvB0D,EAAOgP,aAAe,GACtBM,EAAE,uBAAuBC,SACrBC,UAAWF,EAAE,uBAAuB,GAAGG,aAAe,KACvD,IACF,SAAS5Q,OASlBlD,EAAW6U,IAAI,oBAAqB,SAASC,EAAOC,EAASC,EAAUC,EAAWC,GAChFhK,EAAOoJ,OAAOa,YAAYf,kBAO9BlX,IAAIoF,WAAW,iBAAkB,SAAU,YAAa,aACtD,WAAY,KAAM,SAAU,UAAW,WAAY,YAAa,kBAAmB,KACnF,SAAS+B,EAAQY,EAAW+F,EAAYoK,EAAUnK,EAAI8F,EACpDvR,EAASiL,EAAUmD,EAAWtI,EAAiBzF,GAC/CwE,EAAOgR,sBACPhR,EAAOiR,SACPjR,EAAOkR,SACLC,UAAU,GAGZ/K,EAAS,WACLgL,aAAe9B,EAAE,mBAAmB+B,cAClCnT,SAAW,6BACXoT,iBAAkB,EAClBC,WAAY,EACZC,YAAc,0BACdC,UAAY,KACZC,YAAa,IAGf1R,EAAOoR,aAAeA,aAAa,GAAGC,cAEvC,KAEHjL,EAAS,WACPtN,QAAQuI,QAAQrI,SAASuS,cAAc,yBAAyBoG,GAC9D,QACA,WACE3R,EAAOiH,eAAgB,EACnBjH,EAAOoP,SACPpP,EAAOqP,aAGd,MAEH1I,EAAWiL,gBAAgBhT,KAAK,SAASgJ,GACvC5H,EAAO6H,WAAaD,EAAKtL,IAIzB,KAAK,GAFD6F,GAASnC,EAAO6H,WAAW1F,OAEtB7B,EAAI,EAAO6B,EAAJ7B,EAAYA,IAC1B,GAAiC,WAA7BN,EAAO6H,WAAWvH,GAAGuF,KAAmB,CAC1C7F,EAAOgR,mBAAmBzV,KAAKyE,EAAO6H,WAAWvH,GACjD,UAKNN,EAAO6R,eAAiB,WAEtB7R,EAAO8R,oBAAsB9R,EAAO8R,oBAGtC9R,EAAO+R,UAAY,SAAS9H,GAC1B,GAAI+H,GAAMhS,EAAOgR,mBAAmB9X,QAAQ+Q,EACxC+H,GAAM,GAAIhS,EAAOgR,mBAAmBvQ,OAAOuR,EAAK,GAC/ChS,EAAOgR,mBAAmBzV,KAAK0O,IAGtCjK,EAAOiS,WAAa,SAAShI,GAC3B,MAAqB,WAAjBA,EAASpE,MAAkD,IAA7B7F,EAAO6H,WAAW1F,QAC3C,EAEAnC,EAAOgR,mBAAmB9X,QAAQ+Q,GAAY,GAiBzDjK,GAAOkS,cAAgB,SAAS5R,GAE9BN,EAAOiR,MAAMxQ,OAAOH,EAAG,GAGzB,IAAI6R,GAAe,SAASlB,GAC1B,GAAI1S,GAAI/C,EAAGgD,QACP4T,IAEJpS,GAAOiR,MAAQA,CAEf,IAAIoB,GAAW,SAAS7E,GACtBA,EAAKA,KAAOA,EACZA,EAAKE,OAAShB,EAAOgB,QACnB1P,IAAK7C,EAAU,UACfmB,MACEkR,KAAMA,KAIVA,EAAKE,OAAO9O,KAAK,SAAS3C,GACxBuR,EAAK8E,UAAW,EAChB9E,EAAKO,OAAS9R,EAASK,KAEvB8V,EAAS7W,KAAKU,EAASK,KAAKiW,UAExBtB,EAAM9O,QAAUiQ,EAASjQ,QAC3B5D,EAAEJ,QAAQiU,IAEX,SAASnW,GACVuR,EAAKgF,QAAS,EACVvB,EAAM9O,QAAUiQ,EAASjQ,QAC3B5D,EAAEJ,QAAQiU,IAEX,SAASnE,GACVT,EAAKU,SAAWuE,KAAKC,IAAI,IAAKvE,SAAS,IACrCF,EAAIG,OAASH,EAAII,UAWvB,OAPI4C,IAASA,EAAM9O,QACjBrJ,QAAQ6Z,QAAQ1B,EAAO,SAASzD,GAC9B6E,EAAS7E,KAKNjP,EAAEO,QAIXkB,GAAO4S,YAAc,SAASjP,GAI5BvD,KAAOa,EAAgB+B,SAAS6P,QAAQ7S,EAAOoR,aAAa0B,WAC5DC,UAAY/S,EAAO+S,UAEd3S,OACHA,KAAO,KAGgB,mBAAd2S,WAETA,UAAY,EACHA,UAAUC,cAAe,GAASD,aAAc,EAEzDA,UAAY,EAGZA,UAAY,CAGd,IAAIE,GAAa,SAASC,GAExBlT,EAAOkR,QAAQC,UAAW,CAI1B,KAAK,GAFDvJ,MACA1C,EAAQlF,EAAOgR,mBAAmB7O,OAC7B7B,EAAI,EAAO4E,EAAJ5E,EAAWA,IACzBsH,EAAKrM,KAAKyE,EAAOgR,mBAAmB1Q,GAAGtB,GAIzC4H,GAAGuM,UACD/S,KAAM8S,EAAEE,EACRL,UAAWG,EAAEG,EACbxL,WAAYD,EACZ0L,OAAQJ,EAAE5S,IACT1B,KAAK,SAASC,GACfmB,EAAOkR,QAAQC,UAAW,EAET,MAAbtS,EAAExC,QACJ2D,EAAOwJ,KAAK1J,MAAMyE,QAAQ1F,EAAEvC,MAI9B0D,EAAOoR,aAAamC,QAAQ,IAC5BvT,EAAOI,KAAO,GACdJ,EAAOiH,eAAgB,EACvBjH,EAAOiR,UACN,SAASpS,GACVmB,EAAOkR,QAAQC,UAAW,IAI1BnR,GAAOiR,MAAM9O,OACfgQ,EAAanS,EAAOiR,OAAOrS,KACzB,SAAS4U,GAEPP,GACEG,EAAGhT,KAAKiQ,OACRgD,EAAGN,UACHzS,EAAGkT,MAILpT,KAAKiQ,OACP4C,GACEG,EAAGhT,KAAKiQ,OACRgD,EAAGN,UACHzS,OAGFM,EAAU4D,MAAM,iCAQ1B3L,IAAIoF,WAAW,2BAAA,SAAA,cAAA,uBAAA,oBAA2B,SAAS+B,EAAQ3B,EAAayI,EAAsB2M,GAC1F,GAAIC,IACAzR,YAAa,iBACbJ,WAAY,mBACZE,YAAa,sBACbD,gBAAiB,mBACjBE,eAAgB,sBAGtB3D,GAAYI,IAAI,MAAM6N,IAAI,mBAAmBpI,UAAUtF,KAAK,SAASC,GACnEmB,EAAOkJ,gBAAkBrK,EAAEvC,OAE7B+B,EAAYI,IAAI,MAAM6N,IAAI,iBAAiBpI,SACvCyP,UAAY,IACb/U,KAAK,SAASC,GAEfmB,EAAO+I,iBAEP6K,OAAS/U,EAAEvC,IAEX,KAAK,GAAIgE,GAAI,EAAGA,EAAIsT,OAAOzR,OAAQ7B,IAC/BuT,QACIC,QAASJ,EAAME,OAAOtT,GAAGmC,aACzBjB,KAAMoS,OAAOtT,GAAGkB,MAGpBxB,EAAO+I,cAAcxN,KAAKsY,UAMhC7T,EAAO+T,cAAgBN,EAAkBM,cACzC/T,EAAOgU,mBAAqBP,EAAkBO,sBAIhDnb,IAAIoF,WAAW,oBAAqB,SAAU,YAAa,SAAS+B,EAClE8K,GACA9K,EAAOxC,KAAO,WACZsN,EAAUtN,QAEZwC,EAAOiU,OAAS,WACdnJ,EAAUmJ,UAEZjU,EAAOkU,OAAS,SAASA,GACvBpJ,EAAUtN,KAAK0W,OAInBrb,IAAIoF,WAAW,6BAA8B,SAAU,YACrD,aAAc,qBACd,SAAS+B,EAAQ8K,EAAWnE,EAAYqK,GAEtCrK,EAAWiL,gBAAgBhT,KAAK,SAASuV,GACvCnU,EAAO6H,WAAasM,EAAI7X,KACxBI,QAAQC,IAAIqD,EAAOoU,WAErBpU,EAAOxC,KAAO,WACZsN,EAAUtN,QAEZwC,EAAOiU,OAAS,WACdnJ,EAAUmJ,UAEZjU,EAAOqU,WAAa,SAASrV,GAC3BtC,QAAQC,IAAIqD,EAAOgR,oBAEnBlG,EAAUtN,KAAKwB;AC3yBrBnG,IAAIyb,OAAO,gBAAiB,WACxB,MAAO,UAASC,GAWZ,MAVAC,KAAMD,EACFA,IACIA,GAAO,KAAa,OAANA,EACdC,IAAM/B,KAAKgC,MAAMF,EAAM,KAAO,GAAK,IAC5BA,GAAO,QAAgB,UAANA,EACxBC,IAAM/B,KAAKgC,MAAMF,EAAM,KAAU,GAAK,IAC/BA,GAAO,YACdC,IAAM/B,KAAKgC,MAAMF,EAAM,KAAa,GAAK,MAG1CC;ACZf3b,IAAI6b,QAAQ,aAAc,WACxB,GAAIC,GAAgD,KAAtC3b,SAASC,IAAIC,QAAS,YAA6D,KAAvCF,SAASC,IAAIC,QAAS,WAChF,OAAOyb,MAGT9b,IAAI6b,QAAQ,gBAAA,gBAAgB,SAAShZ,GAEnC,QAASkZ,GAAgBC,GACvB,GAAIC,GAASD,EAAI1Y,QAAQ,IAAK,KAAKA,QAAQ,IAAK,IAChD,QAAQ2Y,EAAO3S,OAAS,GACtB,IAAK,GACH,KACF,KAAK,GACH2S,GAAU,IACV,MACF,KAAK,GACHA,GAAU,GACV,MACF,SACE,KAAM,4BAEV,MAAO7X,QAAO8X,KAAKD,GAGrB,GAAIE,GAAqB,WACvB,GAAIjZ,GAAQL,EAAcK,MACtBkZ,IAGJ,IAAqB,mBAAVlZ,GAAuB,CAChC,GAAImZ,GAAUnZ,EAAMgH,MAAM,KAAK,EAC/BkS,GAASE,KAAKC,MAAMR,EAAgBM,IAGtC,MAAOD,IAGLI,EAAW,WACb,MAAO3Z,GAAcK,MAGvB,QACEA,MAAOiZ,EACPK,SAAUA,MAIdxc,IAAI6b,QAAQ,cAAe,cAAe,OAAQ,KAAM,KAAM,WAAY,SAASrW,EACjFzC,EAAMgL,EAAIpL,EAAI4K,GAEd,GAAIvN,IACFiH,SAGFlE,GAAK0N,iBAAiB1K,KAAK,SAASC,KAMpC,IAAI+J,GAASvK,EAAYiX,QAAQ,UAE7BxL,EAAWzL,EAAYiO,IAAI,SAE3BsF,EAAgB,WAClB,GAAIrT,GAAI/C,EAAGgD,OAYX,OAVA,SAAU+W,KACRlX,EAAYiO,IAAI,cAAcpI,UAAUtF,KAAK,SAASC,GACpDN,EAAEJ,QAAQU,IACT,WACDuH,EAAS,WACPmP,KACC,UAIAhX,EAAEO,SAGP6I,EAAyB,WAC3B,GAAIpJ,GAAI/C,EAAGgD,OAYX,OAVA,SAAU+W,KACRlX,EAAYiO,IAAI,cAAcpI,SAASgB,OAAO,IAAOtG,KAAK,SAASC,GACjEN,EAAEJ,QAAQU,IACT,WACDuH,EAAS,WACPmP,KACC,UAIAhX,EAAEO,QAIX,QACEjG,IAAKA,EACL+P,OAAQA,EACRkB,SAAUA,EACV8H,cAAeA,EACfjK,uBAAwBA,MAK5B9O,IAAI6b,QAAQ,UAAW,eAAgB,YAAa,UAAW,SAAS3N,EAAc7F,EAAW/F,GAE/F0L,OAAOlK,IAAM,SAASwS,GAChBlS,OAAOP,SAAWO,OAAOP,QAAQC,KACnCM,OAAOP,QAAQC,IAAIwS,GAIvB,IAAIc,GAAS,GAAIpJ,QAAO,wBACtB2O,WAAW,EACXC,aAActa,EAAU,eACxBua,MACE5Z,SACEE,cAAiB,UAAY+K,EAAasO,eAK5CM,EAA0B,WAC5B1F,EAAO7W,OAAOsc,KAAK5Z,QAAQE,cAAgB,UAAY+K,EAAasO,WAGtE,QACEpF,OAAQA,EACR0F,wBAAyBA,MAI7B9c,IAAI6b,QAAQ,MAAO,YAAa,WAAY,UAAW,SAAUxT,EAAWL,EAAU+U,GAEpF,MAAG1U,IACE0U,EAAQC,sBACFD,EAAQC,sBAKVhV,KAIXhI,IAAI6b,QAAQ,aAAc,YAAa,WAAY,OAAQ,KAAM,YAC/D,SAAS5J,EAAWiG,EAAUnV,EAAMJ,EAAI+N,GAEtC,GAAI7E,GAAc,SAASf,GACzB,GAAIpF,GAAI/C,EAAGgD,OAcX,OAbAsM,GAAUM,MACNnN,WAAY,mBACZF,YAAa,oCACbuN,OAAQtS,SAAS8c,uBAAuB,iBACxCC,YAAapS,EACb6H,qBAAqB,IAEtB5M,KAAK,SAASuV,GACb5V,EAAEJ,QAAQgW,IACT,WACD5V,EAAE3B,WAGC2B,EAAEO,SAGPuM,EAAQ,SAAS1H,EAAIb,GAIvBgI,EAAUM,KACRN,EAAUO,QACTC,OAAOxS,QAAQuI,QAAQrI,SAASuS,cAAc,UAC9CC,qBAAoB,GACpBtD,MAAMpF,GAEN2I,UAAU3I,GACV4I,GAAG,MACHqK,YAAYpS,KAIba,EAAQ,SAAS1B,GACnBiO,EAAS3F,KACP2F,EAASiF,SACRlC,QAAQhR,GACRmT,SAAS,YACT3K,OAAO/B,EAAU,GAAGgC,cAAc,SAClC2K,UAAU,OAKXzL,EAAY,WACd7O,EAAK4O,WAAW5L,KAAK,WACnBkM,EAAUtN,MAAK,IACd,WACDe,EAAI,gBAIJmM,EAAgB,SAASC,GAC3B/O,EAAKiP,OAAOF,GAAc/L,KAAK,SAASC,GACtCiM,EAAUtN,MAAK,IACd,SAASuM,GACVrN,QAAQC,IAAIoN,KAOhB,QAEErF,YAAaA,EACb2G,MAAOA,EACP7G,MAAOA,EACPiG,UAAWA,EACXC,cAAeA,MAMrB7R,IAAI6b,QAAQ,QAAS,gBAAiB,cAAe,KAAM,SACzD,mBAAoB,WAAY,YAAa,uBAAwB,eAAgB,SACrF,SAAShZ,EAAe2C,EAAa7C,EAAIkL,EAAQ5F,EAAkBD,EAAUK,EAAW4F,EAAsBC,EAAcF,GAC1H,GAAIrF,IACFiD,eAAe,EACfzF,GAAI,KACJmI,QAAS,KACTtB,KAAM,QACNsQ,UAAW,QACXC,SAAU,QACVC,IAAK,KACLrP,SAAU,KACVsP,MAAO,KACP1I,OAAQ,KACR7O,QAAS,KAGXV,GAAYkY,iBAAgB,EAE5B,IAAIjN,GAAiB,WAInB,GAAI/K,GAAI/C,EAAGgD,OAwCX,OAvCIuI,GAAahL,QAAQoL,SAAWJ,EAAahL,QAAQya,IAAMC,KAC5DC,MAAQ,IAOTrY,EAAYI,IAAI,QAASsI,EAAahL,QAAQoL,SAASxI,KACrDI,SAAS,IACRH,KACD,SAASC,GACP8X,EAAiB9X,EAAEvC,MACnBuK,EAAO8O,0BAEP7O,EAAqB8P,eAGrBrY,EAAEJ,SAAQ,IAKZ,SAASU,GACS,KAAZA,EAAExC,SACJG,IAEAsL,KAEFvJ,EAAEJ,SAAQ,KAOd3B,IAGK+B,EAAEO,SAGP6X,EAAmB,SAASE,GAE9BrV,EAAKiD,eAAgB,EACrBjD,EAAKxC,GAAK6X,EAAE7X,GACZwC,EAAK2F,QAAU0P,EAAE1P,QACjB3F,EAAKqE,KAAOgR,EAAE/J,WAAa,IAAM+J,EAAE9J,UACnCvL,EAAK2U,UAAYU,EAAE/J,WACnBtL,EAAK4U,SAAWS,EAAE9J,UAClBvL,EAAKmL,SAAWkK,EAAElK,SAClBnL,EAAKwF,SAAW6P,EAAE7P,SAClBxF,EAAK8U,MAAQO,EAAEP,MACf9U,EAAKoM,OAASiJ,EAAEjJ,OAChBpM,EAAKzC,QAAU8X,EAAE9X,SAGf+X,EAAY,SAAS/a,GAEvBL,EAAcK,MAAQA,EACtByF,EAAKzF,MAAQA,GAGX+P,EAAS,SAASd,GACpB,GAAIzM,GAAI/C,EAAGgD,OAaX,OAXAH,GAAYiX,QAAQ,UAAUlV,KAAK4K,GAASpM,KAAK,SAASC,GAExDiY,EAAUjY,EAAEvC,KAAKP,OACjBuN,IAEA5C,EAAOsB,GAAG,mCACVzJ,EAAEJ,QAAQU,EAAEvC,KAAKP,QAChB,WACDwC,EAAE3B,WAGG2B,EAAEO,SAGP+L,EAAS,SAAStI,GACpB,GAAIhE,GAAI/C,EAAGgD,OAaX,OAXAH,GAAYiX,QAAQ,gBAAgBlV,KAAKmC,GAAG3D,KAAK,SAASC,GAExDiY,EAAUjY,EAAEvC,KAAKP,OACjBuN,IAEA5C,EAAOsB,GAAG,mCACVzJ,EAAEJ,QAAQU,EAAEvC,KAAKP,QAChB,WACDwC,EAAE3B,WAGG2B,EAAEO,SAGP0L,EAAW,WAEb,GAAIjM,GAAI/C,EAAGgD,QAEPuY,EAAY,SAASC,GAEvB,GAAIzY,GAAI/C,EAAGgD,OAmBX,OAlBAK,GAAImY,EACa,cAAbnY,EAAExC,QACJ4a,MACEC,gBAAmBrY,EAAEsY,aAAaC,aAEpC/Y,EAAYiX,QAAQ,YAAYlV,KAAK6W,MAAMrY,KAAK,SAASC,GACvDiY,EAAUjY,EAAEvC,KAAKP,OACjBuN,IAEA/K,EAAEJ,QAAQU,IACT,SAASA,GACVN,EAAE3B,OAAOiC,MAIXN,EAAE3B,SAGG2B,EAAEO,QAyBX,OAtBGoC,GACDJ,EAAiBoK,OAAO,iBAAkB,UAAUtM,KAAK,SAASC,GAChEnC,QAAQC,IAAIkC,GACZkY,EAAUlY,GAAGD,KAAK,WAChBL,EAAEJ,WACD,SAASU,GACVN,EAAE3B,OAAOiC,MAEV,WACDN,EAAE3B,WAGJiE,EAASqK,MAAM,SAASrM,GAEtBkY,EAAUlY,GAAGD,KAAK,WAChBL,EAAEJ,WACD,SAASU,GACVN,EAAE3B,OAAOiC,OAKRN,EAAEO,SAGPgJ,EAAS,WACXhB,EAAqBgK,cACrBuG,qBACO3b,GAAcK,MACrBuN,IACA5C,EAAOsB,GAAG,kBAGRxL,EAAe,WACjBgF,EAAKiD,eAAgB,EACrBjD,EAAKxC,GAAK,KACVwC,EAAK2F,QAAU,KACf3F,EAAKqE,KAAO,QACZrE,EAAK2U,UAAY,QACjB3U,EAAK4U,SAAW,QAChB5U,EAAK6U,IAAM,KACX7U,EAAKwF,SAAW,KAChBxF,EAAK8U,MAAQ,KACb9U,EAAKoM,OAAS,KAGhB,QACE9B,OAAQA,EACRjB,OAAQA,EACRL,SAAUA,EACV1C,OAAQA,EACRwB,eAAgBA,EAChB9M,aAAcA,EACdiF,YAAaD,MAKnB3I,IAAI6b,QAAQ,MAAO,OAAQ,cAAe,KAAM,eAAgB,SAAS9Y,EAAMyC,EAAa7C,EAAIuL,GAE9F,GAAIuQ,GAAMvQ,EAAahL,QAAQwb,IAG3BxL,EAAK1N,EAAYI,IAAI,QAAS6Y,GAE9BnE,EAAW,SAASD,GACtB,MAAO7U,GAAYiO,IAAI,SAASlM,MAC9BA,KAAQ8S,EAAE9S,KACV2S,UAAaG,EAAEH,UACflL,WAAcqL,EAAErL,WAChByL,OAAUJ,EAAEI,SAIhB,QACEtU,GAAIsY,EACJvL,GAAIA,EACJtH,cAAe7I,EAAK6F,YAAYgD,cAChCyH,UAAWH,EAAGO,IAAI,aAClBvN,QAASnD,EAAK6F,YACd0R,SAAUA,MAKdta,IAAI6b,QAAQ,eAAgB,cAAe,KAAM,SAASrW,EAAa7C,GAErE,GAEI4E,IAFQ/B,EAAYiO,IAAI,SAEjB,SAAStN,GAClB,MAAOX,GAAYI,IAAI,QAASO,IAGlC,QACEoB,KAAMA,MAKVvH,IAAI6b,QAAQ,kBAAmB,cAAe,KAAM,SAASrW,EAAa7C,GAExE,GAEIqJ,IAFQxG,EAAYiO,IAAI,YAEd,SAAStN,GACrB,MAAOX,GAAYI,IAAI,WAAYO,IAGrC,QACE6F,QAASA,MAKbhM,IAAI6b,QAAQ,iBAAkB,WAAY,OAAQ,SAAS7T,EAAUjF,GAGnE,YAKF/C,IAAI6b,QAAQ,aAAA,eAAA,SAAa,SAAS3N,EAAcF,GAE9C,GAAI2Q,GAAgB3Q,EAAOoJ,OAAOC,UAAU,yBAA2BnJ,EAAahL,QAAQoL,SAExFsQ,EAA0B,WAG5BD,EAActH,UAAU,yBAA2BnJ,EAAahL,QAAQoL,UAGtE4B,EAAgBlC,EAAOoJ,OAAOC,UAAU,yBAA2BnJ,EAAahL,QAAQoL,QAE5F,QACE4B,cAAeA,EACf0O,wBAAyBA,EACzBC,0BAA2B,WACzB,MAAO7Q,GAAOoJ,OAAOa,YAAY,yBAA2B/J,EAAahL,QAAQoL,cAKvFtO,IAAI6b,QAAQ,wBAAA,eAAA,SAAA,SAAA,eAAA,aAAA,cAAwB,SAAS3N,EAAcF,EAAQH,EAAQpI,EAAc3C,EAAY0C,GAEnG,GAAIsZ,GAAY,KAEZC,KACAhE,KACAiE,KAEAC,EAAe,SAASC,EAAKlL,GAE/B,IAAI,GADA3H,GAAQ6S,EAAI5V,OACR7B,EAAI,EAAO4E,EAAJ5E,EAAWA,IACxB,GAAGyX,EAAIzX,GAAGtB,IAAM6N,EAAI7N,GAClB,MAAOsB,EAGX,OAAO,IAGL0X,EAAqB,SAASC,GAChC,GAA0B,6BAAvBvR,EAAOgD,QAAQ7D,KAAoC,CAClD,GAAIX,GAAQ+S,EAAKC,MAAM/V,MAEvB,KAAI7B,EAAI,EAAGA,EAAI4E,EAAO5E,IACpB,GAAG2X,EAAKC,MAAM5X,GAAG6G,SAAW7I,EAAaI,SAAWuZ,EAAKC,MAAM5X,GAAGqM,UAAYrO,EAAaI,QACzF,OAAO,CAGX,QAAO,IAITyZ,EAAa,WACf,GAAIpR,EAAahL,QAAQoL,QAAzB,CAGA,GAAIiR,GAAIvR,EAAOoJ,OAAOC,UAAU,yBAA2BnJ,EAAahL,QAAQoL,QAChFwQ,GAAYS,EACZA,EAAEjI,KAAK,cAAe,SAAS7T,GAC7B,IAAI0b,EAAmB1b,GAAM,CAC3B,GAAI0V,GAAM8F,EAAaF,EAAStb,EACtB,KAAP0V,IACD4F,EAAQrc,KAAKe,GACTX,EAAWyT,SACbzT,EAAW0T,cAMnB+I,EAAEjI,KAAK,gCAAiC,SAAS9T,GAC/CgC,EAAYI,IAAI,MAAM6N,IAAI,YAAYA,IAAI,UAAUpI,UAAUtF,KAC5D,SAASC,GACP,GAAIqG,GAAQrG,EAAEvC,KAAK6F,MACnByV,GAAQnX,OAAO,EAAG5B,EAAEvC,KAAK6F,OACzB,KAAI,GAAI7B,GAAI,EAAO4E,EAAJ5E,EAAWA,IAItBsX,EAAQrc,KAAKsD,EAAEvC,KAAKgE,GAIpB3E,GAAWyT,SACbzT,EAAW0T,YAKjBhR,EAAYI,IAAI,MAAM6N,IAAI,iBAAiBpI,UAAUtF,KACnD,SAASC,GACP,GAAIqG,GAAQrG,EAAEvC,KAAK6F,MACnByR,GAAOnT,OAAO,EAAG5B,EAAEvC,KAAK6F,OACxB,KAAI,GAAI7B,GAAI,EAAO4E,EAAJ5E,EAAWA,IACtBsT,EAAOrY,KAAKsD,EAAEvC,KAAKgE,GAGnB3E,GAAWyT,SACbzT,EAAW0T,YAKjBhR,EAAYI,IAAI,MAAM6N,IAAI,mBAAmBpI,UAAUtF,KACrD,SAASC,GACP,GAAIqG,GAAQrG,EAAEvC,KAAK6F,MACnB0V,GAAWpX,OAAO,EAAG5B,EAAEvC,KAAK6F,OAC5B,KAAI,GAAI7B,GAAI,EAAO4E,EAAJ5E,EAAWA,IACtBuX,EAAWtc,KAAKsD,EAAEvC,KAAKgE,GAGvB3E,GAAWyT,SACbzT,EAAW0T,cAOnB+I,EAAEjI,KAAK,4BAA6B,SAAS9T,QAO3CqT,EAAqB,SAAST,GAEhC5Q,EAAYI,IAAI,MAAMA,IAAI,WAAYwQ,GAASxQ,IAAI,QAAQ4Z,OAE3D,IAAIrG,GAAM8F,EAAaF,EAAS3I,EAC7B+C,IAAO,GACR4F,EAAQnX,OAAOuR,EAAK,IAIpBlB,EAAc,WAChB6G,EAAU7G,YAAY,yBAA2B/J,EAAahL,QAAQoL,SAKxE,OAFAgR,MAGElP,qBAAsB2O,EACtBvO,cAAeuK,EACfzK,2BAA4B0O,EAC5BnI,mBAAoBA,EACpBoB,YAAaA,EACb8F,aAAcuB,MAIlBtf,IAAI6b,QAAQ,iBAAkB,WAE5B,GAAI7E,GAAgB,SAASkI,GAC3B,GAAI7S,GAAQ6S,EAAI5V,MAEhB,OAAO4V,GAAI7S,EAAQ,GAAGlG,IAGpBsZ,EAAuB,SAASP,GAClC,GAAI7S,GAAQ6S,EAAI5V,MAChB,OAAO4V,GAAI7S,EAAQ,GAAGqT,WAGxB,QACE1I,cAAeA,EACfyI,qBAAsBA,KAI1Bzf,IAAI6b,QAAQ,qBAAA,cAAqB,SAASrW,GAEtC,GAAI0V,GAAgB,SAASyE,GACzBna,EAAYI,IAAI,MAAM6N,IAAI,mBAAmBlM,MACzC1B,QAAS8Z,KAIbxE,EAAqB,SAASwE,GAC9Bna,EAAYI,IAAI,MAAMA,IAAI,kBAAmB+Z,GAAQnY,SAIzD,QACI0T,cAAeA,EACfC,mBAAoBA,MAI5Bnb,IAAI6b,QAAQ,kBAAmB,WAC3B,GAAI1R,GAAW/F,OAAO+F,QAGtB,OAFAA,GAASyV,aAAe,yCAGpBzV,SAAUA","file":"app.js","sourcesContent":["// \"use strict\";\nvar app = angular.module('testify', [\n  'ngMaterial',\n  'chieffancypants.loadingBar',\n  'ngAnimate',\n  'ngMessages',\n  'angularMoment',\n  'ui.router',\n  'ngStorage',\n  'restangular',\n  'facebook',\n  'ngFileUpload',\n  'ngImgCrop',\n  'ngTextTruncate',\n  'ngSanitize',\n  'ngCordova'\n]);\n\nif ( document.URL.indexOf( 'http://' ) === -1 && document.URL.indexOf( 'https://' ) === -1 ) {\n  app.constant('apiBase', \"https://testify-staging.herokuapp.com/api/v1\");\n  app.constant('appBase', \"/\");\n  app.constant('appUrl', \"https://testify-staging.herokuapp.com\");\n} else {\n  app.constant('appUrl', \"https://testify-staging.herokuapp.com\");\n  app.constant('appBase', \"/\");\n  app.constant('apiBase', \"api/v1\");\n}\n\napp.config(function($mdThemingProvider) {\n  var primaryPalette = $mdThemingProvider.extendPalette('blue', {\n    'contrastDefaultColor': 'light',\n    'contrastDarkColors': ['300'],\n    'contrastLightColors': ['100', '500'],\n    '500': '6AA3C8',\n    '50': '1C3456',\n    '100': '5DADE0',\n    '300': 'FAFAFA',\n    '400': 'F4F4F4'\n  });\n  var accentPalette = $mdThemingProvider.extendPalette('green', {\n\n    'contrastDefaultColor': 'light',\n    'contrastDarkColors': ['200', '300'],\n    'contrastLightColors': ['500'],\n    '500': '97B6CA',\n    '50': '1C3456',\n    '100': '5DADE0',\n    '200': 'e74c3c',\n    '300': 'FFFFFF',\n    '400': 'F4F4F4',\n    '600': '27ae60',\n    '700': '77777E'\n  });\n\n  $mdThemingProvider.definePalette('primary', primaryPalette);\n  $mdThemingProvider.definePalette('accent', accentPalette);\n  //console.log($mdThemingProvider.theme('default'));\n  $mdThemingProvider.theme('default')\n    .primaryPalette('primary', {\n      'default': '500',\n      'hue-1': '50',\n      'hue-2': '100',\n      'hue-3': '300'\n    })\n    .accentPalette('accent', {\n      'default': '200',\n      'hue-1': '600',\n      'hue-2': '700'\n    })\n    .warnPalette('red');\n\n});\n\napp.config(['$compileProvider', '$logProvider', '$animateProvider', function ($compileProvider, $logProvider, $animateProvider) {\n  $logProvider.debugEnabled(false);\n  $compileProvider.debugInfoEnabled(false);\n  //$animateProvider.classNameFilter( /\\banimated\\b/ );\n}]);\n\napp.config(function(FacebookProvider, $httpProvider, RestangularProvider,\n  apiBase) {\n  FacebookProvider.setAppId(180042792329807);\n  RestangularProvider.setBaseUrl(apiBase);\n\n  $httpProvider.interceptors.push(['$q', '$location', '$localStorage',\n    function($q, $location, $localStorage, $rootScope, Auth) {\n      return {\n        'request': function(config) {\n          config.headers = config.headers || {};\n          if ($localStorage.token) {\n            config.headers.Authorization = 'Bearer ' + $localStorage.token;\n          }\n          return config;\n        },\n        'response': function(response) {\n          var t = response.headers('Authorization');\n          if (t) {\n            t.replace('Bearer ', '');\n            $localStorage.token = t;\n            //console.log(t);\n          }\n\n          return response;\n        },\n        'responseError': function(response) {\n          if (response.status === 401 || response.status === 400 ||\n            response.status === 403) {\n            if (response.data.error == 'token_expired') {\n              delete $localStorage.token;\n              Auth.resetProfile();\n              $location.path('/signin');\n            } else if (response.data.error == 'token_invalid') {\n              delete $localStorage.token;\n              Auth.resetProfile();\n              $location.path('/signin');\n            } else if (response.data.error == 'Bad Authorization') {\n              delete $localStorage.token;\n              Auth.resetProfile();\n              $location.path('/signin');\n            } else if (response.data.error == 'token_not_provided') {\n              delete $localStorage.token;\n              Auth.resetProfile();\n              $location.path('/signin');\n            }\n\n\n\n            console.log(\"Unauthorized or forbidden\");\n\n          }\n          return $q.reject(response);\n        }\n      };\n    }\n  ]);\n});\n\napp.run(['$cordovaSplashscreen', '$cordovaKeyboard', '$cordovaStatusbar', function($cordovaSplashscreen, $cordovaKeyboard, $cordovaStatusbar) {\n  window.addEventListener('load', function() {\n    new FastClick(document.body);\n  }, false);\n\n  if(document.URL.indexOf( 'http://' ) === -1 && document.URL.indexOf( 'https://' ) === -1){\n    document.addEventListener(\"deviceready\", function () {\n      $cordovaStatusbar.style(1);\n      $cordovaStatusbar.styleHex('#819CAD');\n      $cordovaKeyboard.hideAccessoryBar(true);\n      $cordovaSplashscreen.hide();\n\n    }, false);\n  }\n\n}]);\n\napp.config(function($stateProvider, $urlRouterProvider, $locationProvider,\n  appBase) {\n  $stateProvider\n    .state('web', {\n      //url: appBase,\n      abstract: true,\n      templateUrl: 'views/web.html'\n    }).state('web.app', {\n      abstract: true,\n      url: appBase,\n      templateUrl: 'views/web.app.html'\n    }).state('web.app.login', {\n      url: 'login',\n      templateUrl: 'views/web.app.login.html',\n    }).state('web.app.signup', {\n      url: 'signup',\n      controller: 'LoginCtrl',\n      templateUrl: 'views/web.app.signup.html'\n    }).state('web.app.logout', {\n      url: 'logout',\n      controller: 'LogoutCtrl',\n      template: \" \"\n    }).state('web.app.landing', {\n      url: '',\n      templateUrl: 'views/web.app.landing.html',\n    }).state('web.app.forgot', {\n      url: 'forgot',\n      templateUrl: 'views/web.app.forgot-password.html',\n    }).state('web.app.dashboard', {\n      abstract: true,\n      url: '',\n      templateUrl: 'views/web.app.dashboard.html',\n    }).state('web.app.dashboard.centered', {\n      abstract: true,\n      url: '',\n      templateUrl: 'views/web.app.dashboard.centered.html',\n    }).state('web.app.dashboard.centered.home', {\n      url: 'home',\n      templateUrl: 'views/web.app.dashboard.centered.home.html'\n    }).state('web.app.dashboard.centered.notifications', {\n      url: 'notifications',\n      templateUrl: 'views/web.app.dashboard.notifications.html'\n    }).state('web.app.dashboard.messages', {\n      url: 'messages',\n      templateUrl: 'views/web.app.dashboard.messages.html'\n    }).state('web.app.dashboard.message', {\n      url: 'messages/:user_id',\n      templateUrl: 'views/web.app.dashboard.message.html',\n      controller: 'MessageCtrl',\n      resolve: {\n        messagingUser: function(Restangular, $stateParams, $q){\n          var d = $q.defer();\n          Restangular.one('users', $stateParams.user_id).get().then(\n            function(r) {\n              d.resolve(r.data);\n            });\n          return d.promise;\n        }\n      }\n    }).state('web.app.dashboard.post', {\n      url: 'posts/:hash_id',\n      templateUrl: 'views/web.app.dashboard.post.html'\n    }).state('web.app.dashboard.centered.posts', {\n      url: 'posts?cat',\n      templateUrl: 'views/web.app.dashboard.centered.home.html'\n    }).state('web.app.dashboard.centered.user', {\n      url: 'user/:id',\n      resolve: {\n        profile: function($stateParams, Restangular) {\n          return Restangular.one('users', $stateParams.id).get();\n        }\n      },\n      views: {\n        '': {\n          templateUrl: \"views/web.app.dashboard.centered.profile.html\",\n          controller: 'ProfileCtrl',\n        },\n        '@web.app.dashboard.centered.user': {\n          templateUrl: 'views/web.app.dashboard.profile.activities.html',\n        }\n      }\n    }).state('web.app.dashboard.centered.user.activities', {\n      url: '/activities',\n      templateUrl: 'views/web.app.dashboard.profile.activities.html',\n    }).state('web.app.dashboard.centered.user.favorites', {\n      url: '/favorites',\n      templateUrl: 'views/web.app.dashboard.profile.favorites.html',\n    }).state('web.app.dashboard.centered.user.taps', {\n      url: '/taps',\n      templateUrl: 'views/web.app.dashboard.profile.taps.html',\n    }).state('web.app.dashboard.centered.user.edit', {\n      url: '/edit',\n      views: {\n        '@web.app.dashboard': {\n          templateUrl: 'views/web.app.dashboard.profile.edit.html'\n\n        }\n      }\n    });\n\n  $urlRouterProvider.otherwise(appBase + \"home\");\n\n  if ( document.URL.indexOf( 'http://' ) === -1 && document.URL.indexOf( 'https://' ) === -1 ) {\n\n  } else {\n    $locationProvider.html5Mode({\n      enabled: true,\n      requireBase: false\n    });\n  }\n\n});\n","app.directive('leftSidenav', [function() {\r\n\r\n    return {\r\n        restrict: 'A',\r\n        transclude: true,\r\n        replace: true,\r\n        templateUrl: 'partials/app/left-sidenav.html'\r\n    };\r\n}]);\r\n\r\napp.directive('rightSidenav', [function() {\r\n    return {\r\n        restrict: 'A',\r\n        transclude: true,\r\n        replace: true,\r\n        templateUrl: 'partials/app/right-sidenav.html'\r\n    };\r\n}]);\r\n\r\napp.directive('searchbox', [function() {\r\n    return {\r\n        restrict: 'A',\r\n        transclude: true,\r\n        replace: true,\r\n        templateUrl: 'partials/app/searchbox.html'\r\n    };\r\n}]);\r\n\r\napp.directive('appToolbar', [function() {\r\n    return {\r\n        restrict: 'A',\r\n        transclude: true,\r\n        replace: true,\r\n        templateUrl: 'partials/app/app-toolbar.html'\r\n    };\r\n}]);\r\n\r\napp.directive('appToolbarNoLogin', [function() {\r\n    return {\r\n        restrict: 'A',\r\n        transclude: true,\r\n        replace: true,\r\n        templateUrl: 'partials/app/app-toolbar-no-login.html'\r\n    };\r\n}]);\r\n\r\napp.directive('testifyPosts', ['PostService', function(PostService) {\r\n    return {\r\n        restrict: 'A',\r\n        transclude: true,\r\n        replace: true,\r\n        templateUrl: 'partials/templates/Post/posts.html',\r\n        scope: {\r\n            posts: '=testifyPosts',\r\n            loading: '=loading'\r\n        },\r\n        controller: function($scope) {\r\n            //console.log($scope.posts);\r\n\r\n            this.SDeletePost = function(post_id) {\r\n                PostService.post(post_id).remove().then(function(r) {\r\n                    var i = $scope.posts.map(function(x) {\r\n                            return x.id;\r\n                        })\r\n                        .indexOf(post_id);\r\n                    //console.log($scope);\r\n                    //array.splice(removeIndex, 1);\r\n                    $scope.posts.splice(i, 1);\r\n                    //scope.post = \"\";\r\n                });\r\n\r\n            };\r\n\r\n            $scope.noPosts = false;\r\n\r\n        }\r\n    };\r\n}]);\r\n\r\napp.directive('testifyPost', ['PostService', 'CommentService', 'Auth', 'UXService', 'Facebook', '$cordovaFacebook', 'appUrl', '$filter', 'EmojioneService', 'isCordova', function(PostService, CommentService, Auth, UXService, Facebook, $cordovaFacebook, appUrl, $filter, EmojioneService, isCordova) {\r\n    return {\r\n        restrict: 'A',\r\n        require: \"^?testifyPosts\",\r\n        scope: {\r\n            post: '=testifyPost'\r\n        },\r\n        templateUrl: 'partials/templates/Post/post.html',\r\n        link: function(scope, element, attrs, SuperTPostsCtrl) {\r\n            scope.user = Auth.userProfile;\r\n            scope.CommentsUI = {\r\n                loading: false,\r\n                retryButton: false\r\n            };\r\n\r\n            var actions = {\r\n                'App\\\\Tap': ['tapped into', 'this post'],\r\n                'App\\\\Favorite': ['favorited', 'this post'],\r\n                'App\\\\Amen': ['said amen', 'to this post'],\r\n                'App\\\\Comment': ['commented', 'on this post'],\r\n                'App\\\\Post': ['posted', 'on his wall'],\r\n            };\r\n\r\n            if (scope.post.user_ref_activities) {\r\n                if (scope.post.user_ref_activities.length > 0) {\r\n                    interpretation = '';\r\n                    i = 0;\r\n                    var action;\r\n                    var ref_activities = scope.post.user_ref_activities;\r\n                    l = scope.post.user_ref_activities.length;\r\n\r\n                    if (l == 1) {\r\n                        a_t = ref_activities[0].action_type;\r\n                        interpretation += ' ' +\r\n                            actions[a_t][0] +\r\n                            ' ' + actions[a_t][1];\r\n                    } else if (l == 2) {\r\n\r\n                        for (action in ref_activities) {\r\n                            i++;\r\n                            a_t = ref_activities[action].action_type;\r\n\r\n                            if (i == l - 1) {\r\n                                interpretation += ' ' + actions[a_t][0];\r\n                            }\r\n\r\n                            if (i == l) {\r\n                                interpretation += ' and ' + actions[a_t][0] + ' ' + actions[a_t][1];\r\n                            }\r\n                        }\r\n                    } else if (l > 2) {\r\n                        for (action in ref_activities) {\r\n                            i++;\r\n                            a_t = ref_activities[action].action_type;\r\n                            if (i == l - (l - 1)) {\r\n                                interpretation += ' ' + actions[a_t][0];\r\n                            } else if (i <= l - 1) {\r\n                                interpretation += ', ' + actions[a_t][0];\r\n                            } else if (l >= i) {\r\n                                interpretation += ' and ' + actions[a_t][0] + ' ' + actions[a_t][1];\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    scope.interpretation = interpretation;\r\n                }\r\n\r\n            }\r\n\r\n            scope.showMore = false;\r\n            var less, more;\r\n            var postWordsCount = scope.post.text.split(' ').length;\r\n            more = EmojioneService.emojione.shortnameToImage(scope.post.text);\r\n            if(postWordsCount > 60){\r\n              var all_array = scope.post.text.split(' ');\r\n              less = all_array.slice(0, 59).join(' ') + '&hellip;';\r\n              less = EmojioneService.emojione.shortnameToImage(less);\r\n              scope.optimizedText = less;\r\n              scope.post_truncate = true;\r\n            }else{\r\n              scope.optimizedText = more;\r\n            }\r\n\r\n            scope.toggleMore = function () {\r\n              if(scope.showMore){\r\n                scope.optimizedText = less;\r\n              }else{\r\n                scope.optimizedText = more;\r\n              }\r\n              scope.showMore = !scope.showMore;\r\n            };\r\n\r\n\r\n            var originatorEv;\r\n            scope.openMenu = function($mdOpenMenu, ev) {\r\n                originatorEv = ev;\r\n                $mdOpenMenu(ev);\r\n            };\r\n\r\n            if(scope.post.prayer){\r\n              scope.amens_count = $filter('socialCounter')(scope.post.amens_count);\r\n            }\r\n            scope.taps_count = $filter('socialCounter')(scope.post.taps_count);\r\n            scope.comments_count = $filter('socialCounter')(scope.post.comments_count);\r\n\r\n            scope.showCommentBox = false;\r\n            scope.openCommentBox = function() {\r\n                //console.log(scope.post.post_id);\r\n                scope.CommentsUI.loading = true;\r\n                scope.CommentsUI.retryButton = false;\r\n                PostService.post(scope.post.id).getList('comments').then(function(r) {\r\n                    //console.log(r);\r\n                    scope.post.comments = r.data;\r\n                    scope.CommentsUI.loading = false;\r\n                }, function(r) {\r\n                    scope.CommentsUI.retryButton = true;\r\n                    scope.CommentsUI.loading = false;\r\n                });\r\n\r\n                scope.showCommentBox = true;\r\n            };\r\n\r\n            scope.addComment = function(ev) {\r\n                var doCommentPost = function() {\r\n                    //console.log(Date());\r\n                    if (scope.commentBox) {\r\n                        PostService.post(scope.post.id).post('comments', {\r\n                            text: scope.commentBox\r\n                        }).then(function(r) {\r\n                            scope.post.comments_count++;\r\n                            scope.comments_count = $filter('socialCounter')(scope.post.comments_count);\r\n                            scope.post.comments.unshift(r.data);\r\n                            scope.commentBox = \"\";\r\n                        }, function(r){\r\n                            UXService.toast('Sorry, couldn\\'t post your comment check your network and try again ');\r\n                        });\r\n                    }\r\n                };\r\n                if (Auth.userProfile.authenticated) {\r\n                    doCommentPost();\r\n                } else {\r\n                    UXService.signinModal(ev).then(function() {\r\n                        doCommentPost();\r\n                    }, function() {\r\n                        UXService.toast('Sorry, we couldn\\'t sign you check your network and try again');\r\n                    });\r\n                }\r\n            };\r\n\r\n            scope.deleteComment = function(comment_id) {\r\n                var comment = CommentService.comment(comment_id);\r\n                comment.remove().then(function(r) {\r\n                    //console.log(r);\r\n                    var i = scope.post.comments.map(function(x) {\r\n                            return x.id;\r\n                        })\r\n                        .indexOf(comment_id);\r\n                    //console.log($scope);\r\n                    //array.splice(removeIndex, 1);\r\n                    scope.post.comments.splice(i, 1);\r\n                    scope.post.comments_count--;\r\n                    scope.comments_count = $filter('socialCounter')(scope.post.comments_count);\r\n\r\n                    //scope.post = \"\";\r\n\r\n                });\r\n            };\r\n\r\n            scope.toggleFavorite = function(ev) {\r\n                //console.log(scope.post.post_id)\r\n                var doFavorite = function() {\r\n                    if (scope.post.favorited) {\r\n                        scope.post.favorited = false;\r\n                        scope.post.favorites_count--;\r\n                        PostService.post(scope.post.id).one('favorites').remove().then(function(r) {\r\n                            //console.log(r);\r\n                            scope.post.favorited = r.data.status;\r\n                            scope.post.favorites_count = r.data.count;\r\n                        });\r\n                    } else {\r\n                        scope.post.favorited = true;\r\n                        scope.post.favorites_count++;\r\n                        PostService.post(scope.post.id).one('favorites').post().then(function(r) {\r\n                            //console.log(\"created\");\r\n                            scope.post.favorited = r.data.status;\r\n                            scope.post.favorites_count = r.data.count;\r\n                        });\r\n                    }\r\n                };\r\n                if (Auth.userProfile.authenticated) {\r\n                    doFavorite();\r\n                } else {\r\n                    UXService.signinModal(ev).then(function() {\r\n                        doFavorite();\r\n                    });\r\n\r\n                }\r\n                //console.log(scope.post);\r\n            };\r\n\r\n            scope.toggleTap = function(ev) {\r\n                //console.log(scope.post.post_id)\r\n                var doTap = function() {\r\n                    if (scope.post.tapped_into) {\r\n                        scope.post.tapped_into = false;\r\n                        scope.post.taps_count--;\r\n                        PostService.post(scope.post.id).one('taps').remove().then(function(r) {\r\n                            //console.log(r);\r\n                            scope.post.tapped_into = r.data.status;\r\n                            scope.post.taps_count = r.data.count;\r\n                            scope.taps_count = $filter('socialCounter')(scope.post.taps_count);\r\n                        });\r\n                    } else {\r\n                        scope.post.tapped_into = true;\r\n                        scope.post.taps_count++;\r\n                        PostService.post(scope.post.id).one('taps').post().then(function(r) {\r\n                            //console.log(\"created\");\r\n                            scope.post.tapped_into = r.data.status;\r\n                            scope.post.taps_count = r.data.count;\r\n                            scope.taps_count = $filter('socialCounter')(scope.post.taps_count);\r\n                        });\r\n                    }\r\n                };\r\n\r\n                if (Auth.userProfile.authenticated) {\r\n                    doTap();\r\n                } else {\r\n                    UXService.signinModal(ev).then(function() {\r\n                        doTap();\r\n                    });\r\n                }\r\n                //console.log(scope.post);\r\n            };\r\n\r\n            scope.sayAmen = function(ev) {\r\n                var doSayAmen = function() {\r\n\r\n                    if(scope.post.amen === true){\r\n                        UXService.toast(\"You have already said Amen to this post\");\r\n                        return ;\r\n                    }\r\n\r\n                    scope.post.amen = true;\r\n                    scope.post.amens_count++;\r\n                    PostService.post(scope.post.id).one('amens').post().then(function(r) {\r\n                        scope.post.amen = r.data.status;\r\n                        scope.post.amens_count = r.data.count;\r\n                        scope.amens_count = $filter('socialCounter')(scope.post.amens_count);\r\n                    });\r\n\r\n                };\r\n                if (Auth.userProfile.authenticated) {\r\n                    doSayAmen();\r\n                } else {\r\n                    UXService.signinModal(ev).then(function() {\r\n                        doSayAmen();\r\n                    });\r\n\r\n                }\r\n            };\r\n\r\n            scope.shareToFb = function() {\r\n              var options = {\r\n                method: 'feed',\r\n                link: appUrl,\r\n                picture: appUrl + '/dist/img/testify-fb-share-pic.png',\r\n                name: 'Testify',\r\n                caption: 'Sharing God\\'s goodness',\r\n                description: scope.post.text + ' (Tesfify is a community for sharing your testimonies and engaging with other people\\'s testimonies)'\r\n              };\r\n              if(isCordova){\r\n                $cordovaFacebook.showDialog(options)\r\n                  .then(function(success) {\r\n\r\n                  }, function (error) {});\r\n              }else{\r\n                Facebook.ui(options, function(response) {});\r\n              }\r\n\r\n            };\r\n\r\n            scope.deletePost = function() {\r\n                //scope.post = null;\r\n                SuperTPostsCtrl.SDeletePost(scope.post.id);\r\n\r\n            };\r\n        }\r\n    };\r\n}]);\r\n\r\napp.directive('myIcon', ['$timeout', function($timeout) {\r\n    return {\r\n        restrict: 'E',\r\n        scope: {\r\n            icon: \"@\"\r\n        },\r\n        replace: true,\r\n        link: function(scope, e, attrs) {\r\n            //scope.icon = scope.icon;\r\n        },\r\n        template: \"<i class='mdi mdi-{{::icon}}'></i>\"\r\n    };\r\n}]);\r\n\r\napp.directive('testifyComposer', function($timeout) {\r\n    return {\r\n        restrict: 'A',\r\n        templateUrl: 'partials/app/testifyComposer.html',\r\n        link: function(scope, elem, attrs) {\r\n\r\n\r\n        }\r\n        //controller: 'TComposerCtrl'\r\n    };\r\n});\r\n","app.controller('AppCtrl', function($rootScope, $scope, $mdSidenav, $mdMedia,\n  $location, $state, $q, AppService, Auth, Me, appBase, $filter, Pusher, $stateParams, NotificationsService, TokenService, $timeout) {\n  $scope.location = $location;\n  $scope.user = Auth.userProfile;\n  $scope.composingPost = false;\n  $scope.tokHashId = TokenService.token().hash_id;\n  //$state.go('web.app.login');\n\n  $scope.ui = {\n    showSearch: false,\n    showSideNav: $state,\n    toggleNav: function (which) {\n      if(which === 'left'){\n        $mdSidenav(which).toggle();\n        $mdSidenav('right').close();\n      }else{\n        $mdSidenav(which).toggle();\n        $mdSidenav('left').close();\n      }\n      //console.log(which);\n    },\n    toggleSearchBox: function() {\n      $scope.ui.showSearch = !$scope.ui.showSearch;\n    }\n  };\n  //console.log($state);\n  //$scope.ui.showSideNav = $state.current.data.showSideNav;\n  //console.log($scope.tokHashId);\n\n\n  AppService.getCategoriesWithCount().then(function(cats) {\n    var l = cats.data.length;\n    for(var i = 0; i < l; i++){\n      cats.data[i].count = $filter('socialCounter')(cats.data[i].count);\n    }\n    $scope.categories = cats.data;\n  });\n\n\n  var originatorEv;\n  $scope.openMenu = function($mdOpenMenu, ev) {\n    originatorEv = ev;\n    $mdOpenMenu(ev);\n    //console.log(ev)\n  };\n\n  $scope.logout = function() {\n    Auth.logout();\n    //Me.callInit();\n    //console.log($scope.user);\n  };\n\n  $scope.redirect = function(state) {\n    $state.go(state);\n  };\n\n  $scope.menu = [{\n    link: '',\n    state: 'web.app.dashboard.centered.home',\n    title: 'Feeds',\n    icon: 'home',\n    condition: true,\n    click: ''\n  }];\n\n  $scope.menuAuth = [{\n    link: 'profile',\n    state: \"web.app.dashboard.centered.user({id: user.username || user.hash_id})\",\n    title: 'Profile',\n    icon: 'account',\n    condition: 'user.authenticated',\n    action: null\n  }, {\n    link: '',\n    state: 'web.app.dashboard.messages',\n    title: 'Messages',\n    icon: 'message-text-outline',\n    condition: 'user.authenticated',\n    click: ''\n  }, {\n    link: '',\n    state: \"web.app.dashboard.centered.user.favorites({id: user.username || user.hash_id})\",\n    title: 'Favourites',\n    icon: 'star',\n    condition: 'user.authenticated',\n    action: null\n  }, {\n    link: '',\n    state: \"web.app.dashboard.centered.user.edit({id: user.username || user.hash_id})\",\n    title: 'Preferences',\n    icon: 'settings',\n    condition: 'user.authenticated',\n    action: null\n  }];\n\n  $scope.getSearchResultIcon = function(type) {\n    //console.log(icon[type]);\n    return icon[type];\n  };\n\n  $scope.searchIcons = {\n    \"tag\": \"pound\",\n    \"user\": \"at\"\n  };\n\n  $scope.searchRepo = function(query) {\n    var d = $q.defer();\n    AppService.search.getList({\n      q: query\n    }).then(function(response) {\n      d.resolve(response.data.plain());\n      //console.log(response.data.plain());\n      //return result;\n    }, function() {\n      d.reject();\n    });\n\n    return d.promise;\n  };\n\n  $scope.app = {\n    notifications: {\n      messages: NotificationsService.MessageNotifications,\n      friend_requests: NotificationsService.FriendRequestNotifications,\n      general: NotificationsService.Notifications\n    },\n    messages: {\n      notifications: NotificationsService.MessageNotifications\n    }\n  };\n\n\n\n});\n","app.controller('LandingCtrl', ['Auth', '$state', function(Auth, $state) {\n  Auth.refreshProfile().then(function(){\n    if (Auth.userProfile.authenticated === true) {\n      $state.go('web.app.dashboard.centered.home');\n    }\n  });\n\n\n}]);\n\napp.controller('PostsCtrl', ['AppService', 'Me', '$scope', '$state',\n  '$stateParams', 'Restangular', 'UXService', '$document',\n  function(AppService, Me, $scope, $state, $stateParams, Restangular,\n    UXService, $document) {\n\n      $scope.home = {\n        posts: [],\n        posts_loading: false\n      };\n\n      if ($state.current.name == \"web.app.dashboard.post\") {\n        $scope.home.posts_loading = true;\n\n        Restangular.one('posts', $stateParams.hash_id).get().then(\n          function(r) {\n            $scope.home.posts = [r.data];\n            $scope.home.posts_loading = false;\n          }\n        );\n      }\n\n      if ($state.current.name == \"web.app.dashboard.centered.home\" || \"web.app.dashboard.posts\"){\n        var loadPosts = function() {\n          var param = null;\n          $scope.home.posts_loading = true;\n\n          if ($stateParams.cat) {\n            load({\n              category: $stateParams.cat\n            });\n          } else {\n            load({});\n          }\n\n\n          function load(param) {\n\n            AppService.getPosts.getList(param).then(function(r) {\n              //console.log(AppService.app);\n              $scope.home.posts = r.data;\n              AppService.app.posts = r.data;\n              /*l = r.data.length;\n              for (i = 0; i < l; i++) {\n                  AppService.app.posts.unshift(r.data[i]);\n              }*/\n\n              $scope.home.posts_loading = false;\n              //console.log(r.data.plain());\n            }, function(err) {\n              $scope.home.posts_loading = false;\n              //console.log(err);\n              UXService.toast(\"Something's wrong\");\n            });\n          }\n        };\n\n        loadPosts();\n      }\n\n\n  }\n]);\n\napp.controller('LoginCtrl', ['$scope', 'UXService', 'Facebook', '$q', '$state',\n  'Auth', 'Me', 'appBase',\n  function($scope, UXService, Facebook, $q, $state, Auth, Me, appBase) {\n\n    if (Auth.userProfile.authenticated === true) {\n      $state.go('web.app.dashboard.centered.home');\n    }\n\n    $scope.fb_button = \"Login with Facebook\";\n\n    Facebook.getLoginStatus(function(r) {\n      //console.log(r);\n      if (r.status === 'connected') {\n        //console.log(r);\n        Facebook.api('/me', function(r) {\n          $scope.fb_logged_in = true;\n          $scope.fb_name = r.name;\n          $scope.fb_button = \"Continue as \" + $scope.fb_name;\n        });\n        //console.log(r);\n      } else {\n        //console.log(\"false;\");\n        $scope.fb_logged_in = false;\n        $scope.fb_name = \"null\";\n        $scope.fb_button = \"Login with Facebook\";\n      }\n    });\n\n    $scope.loginFB = function() {\n      Auth.signinFB().then(function() {\n        $state.go('web.app.dashboard.centered.home');\n      }, function(r) {\n        UXService.toast(r.data.error);\n      });\n    };\n\n    $scope.UXLoginFB = function() {\n      UXService.UXLoginFB();\n    };\n\n    $scope.UXSubmitLogin = function() {\n      UXService.UXSubmitLogin($scope.loginDetails);\n    };\n\n    var refresh = function() {\n      Facebook.api(\"/me\", {\n        fields: 'id,name,email,access_token'\n      }).then(\n        function(response) {\n          $scope.welcomeMsg = \"Welcome \" + response.name;\n          console.log(response);\n          //console.log(JSON.stringify(response));\n        },\n        function(err) {\n          $scope.welcomeMsg = \"Please log in\";\n        });\n    };\n\n    $scope.submitLogin = function() {\n      Auth.signin($scope.loginDetails).then(function(r) {\n        //console.log($scope.user);\n        $state.go('web.app.dashboard.centered.home');\n        //Me.callInit();\n        //Success Login\n      }, function(err) {\n        UXService.toast('Wrong username or password');\n      });\n    };\n\n  }\n]);\n\napp.controller('SignupCtrl', ['$scope', 'Facebook', 'Auth', '$location',\n  '$mdDialog', '$state',\n  function($scope, Facebook, Auth, $location, $mdDialog, $state) {\n    var refresh;\n\n    $scope.newUser = {};\n    $scope.signupFb = function() {\n      Facebook.login().then(function() {\n        refresh();\n      });\n    };\n\n    refresh = function() {\n      Facebook.api(\"/me\", {\n        fields: 'id,first_name,last_name,email'\n      }).then(\n        function(response) {\n          Facebook.logout();\n          //$scope.welcomeMsg = \"Welcome \" + response.name;\n          //console.log(response);\n          //console.log(JSON.stringify(response));\n          //Auth.BuildSession(name, id, lastname for appctrl scope);\n          //$location.path('/');\n        },\n        function(err) {\n          $mdDialog.show(\n            $mdDialog.alert()\n            .parent(angular.element(document.querySelector('body')))\n            .clickOutsideToClose(true)\n            .title('Login failed!')\n            //.content('Login failed')\n            .ariaLabel('Failed login')\n            .ok('close')\n            //.targetEvent(ev)\n          );\n\n          //$scope.welcomeMsg = \"Please log in\";\n        });\n    };\n\n    $scope.submitForm = function() {\n      //console.log($scope.newUser);\n      //console.log($scope.signupForm.$valid);\n      if ($scope.signupForm.$valid) {\n        Auth.signup($scope.newUser).then(\n          function(r) {\n\n            $state.go('web.app.dashboard.centered.home');\n            //console.log(r);\n          },\n          function(r) {\n            //console.log(r);\n          });\n      }\n    };\n\n  }\n]);\n\napp.controller('LogoutCtrl', ['$scope', 'Auth', 'Me', function($scope, Auth, Me) {\n  Auth.logout();\n  //$scope.logout();\n  console.log(\"mayama\");\n}]);\n\napp.controller('ProfileCtrl', ['Restangular', '$scope', '$stateParams',\n  '$state', 'Auth',\n  function(Restangular, $scope, $stateParams, $state, Auth) {\n    //console.log(profile);\n    $scope.me = Auth.userProfile;\n    var user_profile = Restangular.one('users', $stateParams.id);\n\n    $scope.user = {\n      profile: {},\n      activities: {posts:[], loading: true},\n      favorites: {posts:[], loading: true},\n      taps: {posts:[], loading: true}\n    };\n\n    $scope.loadUserProfile = function() {\n      Restangular.one('users', $stateParams.id).get({\n          profile: true\n      }).then(function(r){\n        $scope.user_profile = r.data;\n      });\n    };\n\n    $scope.loadUserActivities = function() {\n      $scope.user.activities.loading = true;\n      user_profile.all('activities').getList().then(function(r) {\n        $scope.user.activities.posts = r.data;\n        $scope.user.activities.loading = false;\n      });\n    };\n\n    $scope.loadUserFavorites = function() {\n      $scope.user.favorites.loading = true;\n\n      user_profile.all('favorites').getList().then(function(r) {\n        $scope.user.favorites.posts = r.data;\n        $scope.user.favorites.loading = false;\n\n      });\n    };\n\n    $scope.loadUserTaps = function() {\n      $scope.user.taps.loading = true;\n\n      user_profile.all('taps').getList().then(function(r) {\n        $scope.user.taps.posts = r.data;\n        $scope.user.taps.loading = false;\n\n      });\n    };\n\n    $scope.sendFriendRequest = function(id){\n      Restangular.one('me').all('friends').post({user_id: id});\n\n    };\n\n    var load = function(){\n      $scope.loadUserProfile();\n\n      switch ($state.current.name) {\n        case 'web.app.dashboard.user.favorites':\n          $scope.loadUserFavorites();\n          break;\n        case 'web.app.dashboard.user.taps':\n          $scope.loadUserTaps();\n          break;\n        case 'web.app.dashboard.user.activities':\n          $scope.loadUserActivities();\n          break;\n        default:\n          $scope.loadUserActivities();\n        }\n\n    };\n\n    load();\n\n  }\n]);\n\napp.controller('ProfileEditCtrl', ['Restangular', '$scope', '$stateParams',\n  '$state', 'Upload', 'Auth', 'UXService', 'apiBase',\n  function(Restangular, $scope, $stateParams, $state, Upload, Auth,\n    UXService, apiBase) {\n    //console.log(profile);\n    Restangular.one('me').get({\n      'profile': true\n    }).then(\n      function(r) {\n        $scope.user_profile = r.data;\n      }\n    );\n    $scope.user = Auth.userProfile;\n\n    if (!(Auth.userProfile.hash_id == $stateParams.id || Auth.userProfile.username ==\n        $stateParams.id)) {\n      console.log($stateParams);\n      $state.go('web.app.dashboard.centered.home');\n    }\n\n    $scope.saveAccountInfo = function(obj) {\n      Restangular.one('me').post(\n        'profile', obj).then(function(r) {\n        Auth.userProfile.first_name = obj.first_name;\n        Auth.userProfile.last_name = obj.last_name;\n        Auth.userProfile.username = obj.username;\n\n        $scope.section_account = false;\n      });\n\n    };\n\n    $scope.saveAboutInfo = function(obj) {\n      Restangular.one('me').post(\n        'profile', obj);\n      Auth.userProfile.location = obj.location;\n      if(Auth.userProfile.profile === null){\n        Auth.userProfile.profile = {};\n      }\n      Auth.userProfile.profile.favorite_book = obj.favorite_book;\n      Auth.userProfile.profile.favorite_verse = obj.favorite_verse;\n      Auth.userProfile.profile.favorite_parable = obj.favorite_parable;\n      Auth.userProfile.profile.denomination = obj.denomination;\n\n      $scope.section_about_me = false;\n    };\n\n    $scope.uploadAvatar = function(file) {\n      $scope.uploading = true;\n\n      Upload.upload({\n        url: apiBase + '/me/profile/avatar',\n        data: {\n          file: Upload.dataUrltoBlob(file)\n        }\n      }).then(function(r) {\n        Auth.userProfile.avatar = r.data.url;\n        UXService.toast('Successfully updated your display picture');\n\n      }, function() {\n        //console.log(file);\n        UXService.toast('Changing display picture wasn\\'t successful');\n      }).finally(function() {\n        $scope.uploading = false;\n        $scope.picFile = '';\n      });\n    };\n\n    $scope.upload = function(dataUrl) {\n      console.log(9);\n      Upload.upload({\n        url: 'https://angular-file-upload-cors-srv.appspot.com/upload',\n        data: {\n          file: Upload.dataUrltoBlob(dataUrl)\n        },\n      }).then(function(response) {\n        $timeout(function() {\n          $scope.result = response.data;\n        });\n      }, function(response) {\n        if (response.status > 0) $scope.errorMsg = response.status +\n          ': ' + response.data;\n      }, function(evt) {\n        $scope.progress = parseInt(100.0 * evt.loaded / evt.total);\n      });\n    };\n\n    $scope.changePassword = function() {\n      if ($scope.password.newPassword &&\n        $scope.password.newPassword1 && $scope.password.newPassword === $scope.password.newPassword1) {\n        Restangular.one('me').post('password',\n          $scope.password).then(function(resp) {\n          if (resp.status == 202) {\n            UXService.toast('Successfully changed password');\n          }\n        }, function(resp) {\n          UXService.toast('Something\\'s wrong');\n        });\n      } else {\n        UXService.toast('Please repeat the password');\n      }\n    };\n\n  }\n]);\n\napp.controller('MessagesCtrl', ['$scope', '$state', '$stateParams', 'Restangular', 'Auth' , 'Pusher', function($scope, $state, $stateParams, Restangular, Auth, Pusher) {\n  $scope.chats = [];\n\n  Restangular.all('me').all('messages').getList().then(\n    function(r) {\n      //console.log(r);\n      var chats = r.data;\n      var getOtherUserFromSubs = function(subs){\n        var count  = subs.length;\n\n        for(var i = 0; i < count; i++){\n          if(subs[i].user_id != Auth.userProfile.id){\n            return subs[i].user;\n          }\n        }\n      };\n\n      var count = r.data.length;\n      for(var i = 0; i < count; i++){\n        chats[i].otherUser = getOtherUserFromSubs(r.data[i].subs);\n      }\n\n      $scope.chats = chats;\n    },function(r) {\n\n    }\n  );\n\n}]);\n\napp.controller('MessageCtrl', ['$scope', '$rootScope', 'messagingUser', 'Restangular', 'Auth', '$stateParams', '$state', 'Pusher', 'NotificationsService', 'UtilityService', function($scope, $rootScope, messagingUser, Restangular, Auth, $stateParams, $state, Pusher, NotificationsService, UtilityService){\n  $scope.messages = [];\n  $scope.inputMessage = '';\n  $scope.messagingUser = messagingUser;\n  var chat_channel = \"\";\n  var chat_id = null;//will be set after call to server in restangular promise\n\n  if(!$stateParams.user_id){\n    $state.go('web.app.dashboard.centered.home');\n  }\n\n  var push_new_message = function(message){\n    $scope.messages.push(message);\n\n    if(!$scope.$$phase){\n      $scope.$digest();\n    }\n\n    $(\"#messages-container\").animate({\n        scrollTop: $(\"#messages-container\")[0].scrollHeight + 500\n    }, 500);\n\n    NotificationsService.clearNotifications(chat_id);//TO-DO::: MAKE THIS A SERVER CALL TO CLEAR NOTIFICATION ON SERVER SIDE\n  };\n\n  var subscription_succeeded = function(message){\n    //$scope.messages.push(message);\n    smartLoad($scope.messages);\n  };\n\n  var smartLoad = function(messages){\n    var id = UtilityService.findHighestID(messages);\n    //console.log(id);\n\n    Restangular.all('me').all('messages').one($stateParams.user_id).get({\n      after: id\n    }).then(\n      function(r) {\n        //console.log($stateParams.user_id);\n        var count = r.data.length;\n        if(count){\n          for(var i = 0; i < count; i++){\n            $scope.messages.push(r.data[i]);\n          }\n          NotificationsService.clearNotifications(chat_id);\n        }\n\n        $(\"#messages-container\").animate({\n            scrollTop: $(\"#messages-container\")[0].scrollHeight + 500\n        }, 1);\n\n      },function(r) {\n\n    });\n\n  };\n\n  Restangular.all('me').all('messages').one($stateParams.user_id).getList().then(\n    function(r) {\n      //console.log(r.headers('X-CHAT-ID'));\n      chat_id = r.headers('X-CHAT-ID');\n      chatChannel = 'private-message-' + chat_id;\n      $scope.messages = r.data;\n      if(r.length){\n        NotificationsService.clearNotifications(chat_id);\n      }\n      var pm = Pusher.pusher.subscribe(chatChannel);\n\n      pm.bind('new_message', push_new_message);\n      pm.bind('pusher:subscription_succeeded', subscription_succeeded);\n\n      $(\"#messages-container\").animate({\n          scrollTop: $(\"#messages-container\")[0].scrollHeight + 500\n      }, 1);\n\n    },function(r) {\n\n  });\n\n  $scope.sendMessage = function(){\n      if($scope.inputMessage.trim()){\n        Restangular.all('users').one($stateParams.user_id).all('messages').post({\n          message: $scope.inputMessage,\n          socket_id: Pusher.pusher.connection.socket_id\n        }).then(function(r){\n          $scope.messages.push(r.data);\n          $scope.inputMessage = '';\n          $(\"#messages-container\").animate({\n              scrollTop: $(\"#messages-container\")[0].scrollHeight + 500\n          }, 1);\n        }, function(r){\n\n        });\n      }else{\n        //Do nothing!!!;\n      }\n\n    };\n\n  $rootScope.$on('$stateChangeStart', function(event, toState, toParams, fromState, fromParams){\n    Pusher.pusher.unsubscribe(chatChannel);\n  });\n\n\n\n}]);\n\napp.controller('TComposerCtrl', ['$scope', 'UXService', 'AppService',\n  '$mdToast', 'Me', 'Upload', 'apiBase', '$timeout', '$document', 'EmojioneService', '$q',\n  function($scope, UXService, AppService, $mdToast, Me, Upload,\n    apiBase, $timeout, $document, EmojioneService, $q) {\n    $scope.selectedCategories = [];\n    $scope.files = [];\n    $scope.newPost = {\n      creating: false\n    };\n\n    $timeout(function () {\n        emojionearea = $('#tComposerInput').emojioneArea({\n          template : \"<filters/><editor/><tabs/>\",\n          autoHideFilters : true,\n          useSprite : false,\n          placeholder : \"Share your testimony...\",\n          container : null,\n          hideSource : true,\n\n        });\n        $scope.emojionearea = emojionearea[0].emojioneArea;\n        //console.log($scope.emojionearea);\n    }, 1000);\n\n    $timeout(function () {\n      angular.element(document.querySelector('.emojionearea-editor')).on(\n        'focus',\n        function() {\n          $scope.composingPost = true;\n          if(!$scope.$$phase){\n              $scope.$digest();\n          }\n        });\n    }, 1050);\n\n    AppService.getCategories().then(function(cats) {\n      $scope.categories = cats.data;\n\n      var length = $scope.categories.length;\n\n      for (var i = 0; i < length; i++) {\n        if ($scope.categories[i].name == 'General') {\n          $scope.selectedCategories.push($scope.categories[i]);\n          break;\n        }\n      }\n    });\n\n    $scope.toggleCatPopup = function() {\n\n      $scope.showSelectCatPopup = !$scope.showSelectCatPopup;\n    };\n\n    $scope.catsClick = function(category) {\n      var idx = $scope.selectedCategories.indexOf(category);\n      if (idx > -1) $scope.selectedCategories.splice(idx, 1);\n      else $scope.selectedCategories.push(category);\n    };\n\n    $scope.catsExists = function(category) {\n      if (category.name == 'General' && $scope.categories.length === 0) {\n        return true;\n      } else {\n        return $scope.selectedCategories.indexOf(category) > -1;\n\n      }\n    };\n\n    var isUploadFinished = function() {\n      finished = true;\n\n      angular.forEach($scope.files, function(file, key) {\n        if (file.complete !== true) {\n          finished = false;\n        }\n\n      });\n      return finished;\n    };\n\n    $scope.removePicture = function(i) {\n\n      $scope.files.splice(i, 1);\n    };\n\n    var uploadImages = function(files) {\n      var d = $q.defer();\n      var finished = [];\n\n      $scope.files = files;\n\n      var doUpload = function(file) {\n        file.file = file;\n        file.upload = Upload.upload({\n          url: apiBase + '/images',\n          data: {\n            file: file\n          }\n        });\n\n        file.upload.then(function(response) {\n          file.complete = true;\n          file.result = response.data;\n          //console.log(response);\n          finished.push(response.data.image_id);\n\n          if (files.length == finished.length) {\n            d.resolve(finished);\n          }\n        }, function(response) {\n          file.failed = true;\n          if (files.length == finished.length) {\n            d.resolve(finished);\n          }\n        }, function(evt) {\n          file.progress = Math.min(100, parseInt(100.0 *\n            evt.loaded / evt.total));\n        });\n      };\n\n      if (files && files.length) {\n        angular.forEach(files, function(file) {\n          doUpload(file);\n        });\n\n\n      }\n      return d.promise;\n\n    };\n\n    $scope.composePost = function(ev) {\n      //post = \"\";\n      //console.log($scope);\n      //post = EmojioneService.emojione.toShort($scope.post);\n      post = EmojioneService.emojione.toShort($scope.emojionearea.getText());\n      anonymous = $scope.anonymous;\n\n      if (!post) {\n        post = \" \";\n      }\n\n      if (typeof anonymous === \"undefined\") {\n\n        anonymous = 0;\n      } else if (anonymous.$viewValue === false || anonymous === false) {\n\n        anonymous = 0;\n      } else {\n\n        anonymous = 1;\n      }\n\n      var createPost = function(o) {\n        //console.log(Me.sendPost);\n        $scope.newPost.creating = true;\n\n        var cats = [];\n        var count = $scope.selectedCategories.length;\n        for (var i = 0; i < count; i++) {\n          cats.push($scope.selectedCategories[i].id);\n        }\n\n\n        Me.sendPost({\n          post: o.p,\n          anonymous: o.a,\n          categories: cats,\n          images: o.i\n        }).then(function(r) {\n          $scope.newPost.creating = false;\n\n          if (r.status === 201) {\n            $scope.home.posts.unshift(r.data);\n            //console.log(r.data);\n          }\n\n          $scope.emojionearea.setText(\"\");\n          $scope.post = \"\";\n          $scope.composingPost = false;\n          $scope.files = [];\n        }, function(r) {\n          $scope.newPost.creating = false;\n        });\n      };\n\n      if ($scope.files.length) {\n        uploadImages($scope.files).then(\n          function(id_arr) {\n            //console.log(id_arr);\n            createPost({\n              p: post.trim(),\n              a: anonymous,\n              i: id_arr\n            });\n          });\n      } else {\n        if (post.trim()) {\n          createPost({\n            p: post.trim(),\n            a: anonymous,\n            i: []\n          });\n        } else {\n          UXService.toast(\"Your post has no content!\");\n        }\n\n      }\n    };\n  }\n]);\n\napp.controller('NotificationsController', function($scope, Restangular, NotificationsService, FriendshipService){\n    var types = {\n        'App\\\\Post': 'created a post',\n        'App\\\\Tap': 'tapped on a post',\n        'App\\\\Amen': 'said amen to a post',\n        'App\\\\Favorite': 'favorited a post',\n        'App\\\\Comment': 'commented on a post',\n    };\n\n  Restangular.one('me').all('friend_requests').getList().then(function(r){\n    $scope.friend_requests = r.data;\n  });\n  Restangular.one('me').all('notifications').getList({\n      \"profiles\": true\n  }).then(function(r){\n    //$scope.notifications = r.data;\n    $scope.notifications = [];\n\n    notifs = r.data;\n\n    for (var i = 0; i < notifs.length; i++){\n        aNotif = {\n            content: types[notifs[i].action_type],\n            user: notifs[i].user\n        };\n\n        $scope.notifications.push(aNotif);\n    }\n\n\n  });\n\n  $scope.acceptRequest = FriendshipService.acceptRequest;\n  $scope.deleteRelationship = FriendshipService.deleteRelationship;\n\n});\n\napp.controller('UXModalLoginCtrl', ['$scope', '$mdDialog', function($scope,\n  $mdDialog) {\n  $scope.hide = function() {\n    $mdDialog.hide();\n  };\n  $scope.cancel = function() {\n    $mdDialog.cancel();\n  };\n  $scope.answer = function(answer) {\n    $mdDialog.hide(answer);\n  };\n}]);\n\napp.controller('UXModalPostCategorizeCtrl', ['$scope', '$mdDialog',\n  'AppService', 'selectedCategories',\n  function($scope, $mdDialog, AppService, selectedCategories) {\n\n    AppService.getCategories().then(function(res) {\n      $scope.categories = res.data;\n      console.log($scope.actives);\n    });\n    $scope.hide = function() {\n      $mdDialog.hide();\n    };\n    $scope.cancel = function() {\n      $mdDialog.cancel();\n    };\n    $scope.filePostIn = function(id) {\n      console.log($scope.selectedCategories);\n\n      $mdDialog.hide(id);\n    };\n  }\n]);\n","app.filter('socialCounter', function() {\r\n    return function(num) {\r\n        out = num;\r\n        if (num) {\r\n            if (num >= 999 && num < 999999) {\r\n                out = Math.round(num / 100) / 10 + \"K\";\r\n            } else if (num >= 999999 && num < 999999999) {\r\n                out = Math.round(num / 100000) / 10 + \"M\";\r\n            } else if (num >= 999999999) {\r\n                out = Math.round(num / 100000000) / 10 + \"B\";\r\n            }\r\n        }\r\n        return out;\r\n    };\r\n});\r\n","app.factory('isCordova', [function(){\n  var cordova = document.URL.indexOf( 'http://' ) === -1 && document.URL.indexOf( 'https://' ) === -1;\n  return cordova;\n}]);\n\napp.factory('TokenService', function($localStorage){\n\n  function urlBase64Decode(str) {\n    var output = str.replace('-', '+').replace('_', '/');\n    switch (output.length % 4) {\n      case 0:\n        break;\n      case 2:\n        output += '==';\n        break;\n      case 3:\n        output += '=';\n        break;\n      default:\n        throw 'Illegal base64url string!';\n    }\n    return window.atob(output);\n  }\n\n  var getClaimsFromToken = function() {\n    var token = $localStorage.token;\n    var claims = {};\n\n    //console.log(token);\n    if (typeof token !== 'undefined') {\n      var encoded = token.split('.')[1];\n      claims = JSON.parse(urlBase64Decode(encoded));\n    }\n\n    return claims;\n  };\n\n  var rawToken = function(){\n    return $localStorage.token;\n  };\n\n  return {\n    token: getClaimsFromToken,\n    rawToken: rawToken\n  };\n});\n\napp.factory('AppService', ['Restangular', 'Auth', 'Me', '$q', '$timeout', function(Restangular,\n  Auth, Me, $q, $timeout) {\n\n  var app = {\n    posts: []\n  };\n\n  Auth.refreshProfile().then(function(r) {\n    //Me.callInit();\n    //console.log(\"letsee\");\n  });\n  //console.log(\"appService\");\n\n  var search = Restangular.service('search');\n\n  var getPosts = Restangular.all('posts');\n\n  var getCategories = function(){\n    var d = $q.defer();\n\n    (function makeCall(){\n      Restangular.all('categories').getList().then(function(r){\n        d.resolve(r);\n      }, function(){\n        $timeout(function () {\n          makeCall();\n        }, 10000);\n      });\n    })();\n\n    return d.promise;\n  };\n\n  var getCategoriesWithCount = function(){\n    var d = $q.defer();\n\n    (function makeCall(){\n      Restangular.all('categories').getList({count: true}).then(function(r){\n        d.resolve(r);\n      }, function(){\n        $timeout(function () {\n          makeCall();\n        }, 10000);\n      });\n    })();\n\n    return d.promise;\n  };\n\n\n  return {\n    app: app,\n    search: search,\n    getPosts: getPosts,\n    getCategories: getCategories,\n    getCategoriesWithCount: getCategoriesWithCount\n\n  };\n}]);\n\napp.factory('Pusher', ['TokenService', 'isCordova', 'apiBase', function(TokenService, isCordova, apiBase){\n\n  Pusher.log = function(message) {\n    if (window.console && window.console.log) {\n      window.console.log(message);\n    }\n  };\n\n  var pusher = new Pusher('b5fa9d11972af2e0b8d1', {\n    encrypted: true,\n    authEndpoint: apiBase + '/pusher/auth',\n    auth: {\n      headers: {\n        'Authorization': 'Bearer ' + TokenService.rawToken()\n      }\n    }\n  });\n\n  var headerAuthBearerRefresh = function () {\n    pusher.config.auth.headers.Authorization = 'Bearer ' + TokenService.rawToken();\n  };\n\n  return {\n    pusher: pusher,\n    headerAuthBearerRefresh: headerAuthBearerRefresh\n  };\n}]);\n\napp.factory('FB', ['isCordova', 'Facebook', '$window', function (isCordova, Facebook, $window) {\n\n  if(isCordova){\n    if($window.facebookConnectPlugin){\n      return $window.facebookConnectPlugin;\n    }else {\n      return Facebook;\n    }\n  }else {\n    return Facebook;\n  }\n}]);\n\napp.factory('UXService', ['$mdDialog', '$mdToast', 'Auth', '$q', '$document',\n  function($mdDialog, $mdToast, Auth, $q, $document) {\n\n    var signinModal = function(ev) {\n      var d = $q.defer();\n      $mdDialog.show({\n          controller: 'UXModalLoginCtrl',\n          templateUrl: 'partials/app/ux.signin.modal.html',\n          parent: document.getElementsByClassName(\"dialog-holder\"),\n          targetEvent: ev,\n          clickOutsideToClose: true\n        })\n        .then(function(res) {\n          d.resolve(res);\n        }, function() {\n          d.reject();\n        });\n\n      return d.promise;\n    };\n\n    var alert = function(ev, text) {\n      // Appending dialog to document.body to cover sidenav in docs app\n      // Modal dialogs should fully cover application\n      // to prevent interaction outside of dialog\n      $mdDialog.show(\n        $mdDialog.alert()\n        .parent(angular.element(document.querySelector('body')))\n        .clickOutsideToClose(true)\n        .title(text)\n        //.content(text)\n        .ariaLabel(text)\n        .ok('OK')\n        .targetEvent(ev)\n      );\n    };\n\n    var toast = function(text) {\n      $mdToast.show(\n        $mdToast.simple()\n        .content(text)\n        .position('top left')\n        .parent($document[0].querySelector('body'))\n        .hideDelay(7000)\n      );\n\n    };\n\n    var UXLoginFB = function() {\n      Auth.signinFB().then(function() {\n        $mdDialog.hide(true);\n      }, function() {\n        d = \"Do nothing\";\n      });\n    };\n\n    var UXSubmitLogin = function(loginDetails) {\n      Auth.signin(loginDetails).then(function(r) {\n        $mdDialog.hide(true);\n      }, function(err) {\n        console.log(err);\n        //console.log($scope.loginDetails);\n      });\n    };\n\n\n\n    return {\n\n      signinModal: signinModal,\n      alert: alert,\n      toast: toast,\n      UXLoginFB: UXLoginFB,\n      UXSubmitLogin: UXSubmitLogin\n\n    };\n  }\n]);\n\napp.factory('Auth', ['$localStorage', 'Restangular', '$q', '$state',\n  '$cordovaFacebook', 'Facebook', 'isCordova', 'NotificationsService', 'TokenService', 'Pusher',\n  function($localStorage, Restangular, $q, $state, $cordovaFacebook, Facebook, isCordova, NotificationsService, TokenService, Pusher) {\n    var user = {\n      authenticated: false,\n      id: null,\n      hash_id: null,\n      name: \"Guest\",\n      firstName: \"Guest\",\n      lastName: \"Guest\",\n      sex: null,\n      location: null,\n      email: null,\n      avatar: null,\n      profile: null\n    };\n\n    Restangular.setFullResponse(true);\n\n    var refreshProfile = function() {\n      //console.log(TokenService.token.hash_id);\n      //console.log(TokenService.token().hash_id);\n      //console.log(TokenService.token().exp);\n      var d = $q.defer();\n      if (TokenService.token().hash_id && TokenService.token().exp > Date\n        .now() / 1000) {\n        //console.log(\"truthy\");\n        //console.log(getClaimsFromToken().hash_id);\n        //console.log(Date.now() / 1000);\n        //console.log(getClaimsFromToken().exp);\n        //console.log(TokenService.token.hash_id);\n\n        Restangular.one('users', TokenService.token().hash_id).get({\n          profile: true\n        }).then(\n          function(r) {\n            buildAuthProfile(r.data);\n            Pusher.headerAuthBearerRefresh();//get the fresh token\n            //console.log(Pusher.pusher);\n            NotificationsService.reInitPusher();\n            //console.log(Pusher.pusher);\n\n            d.resolve(true);\n\n            //console.log(getClaimsFromToken().id);\n\n          },\n          function(r) {\n            if (r.status == 404) {\n              resetProfile();\n              //console.log(\"user not found\");\n              logout();\n            }\n            d.resolve(false);\n\n          });\n      } else {\n        //console.log(Date.now() / 1000);\n        //console.log(getClaimsFromToken().exp);\n        //delete $localStorage.token;\n        resetProfile();\n      }\n\n      return d.promise;\n    };\n\n    var buildAuthProfile = function(u) {\n      //console.log(u);\n      user.authenticated = true;\n      user.id = u.id;\n      user.hash_id = u.hash_id;\n      user.name = u.first_name + ' ' + u.last_name;\n      user.firstName = u.first_name;\n      user.lastName = u.last_name;\n      user.username = u.username;\n      user.location = u.location;\n      user.email = u.email;\n      user.avatar = u.avatar;\n      user.profile = u.profile;\n    };\n\n    var saveToken = function(token) {\n\n      $localStorage.token = token;\n      user.token = token;\n    };\n\n    var signup = function(newUser) {\n      var d = $q.defer();\n\n      Restangular.service('signup').post(newUser).then(function(r) {\n        //console.log(r);\n        saveToken(r.data.token);\n        refreshProfile(); //Refresh session data here\n        //$scope.refreshProfile();\n        $state.go('web.app.dashboard.centered.home');\n        d.resolve(r.data.token);\n      }, function() {\n        d.reject();\n      });\n\n      return d.promise;\n    };\n\n    var signin = function(l) {\n      var d = $q.defer();\n\n      Restangular.service('authenticate').post(l).then(function(r) {\n        //console.log(r);\n        saveToken(r.data.token);\n        refreshProfile(); //Refresh session data here\n        //$scope.refreshProfile();\n        $state.go('web.app.dashboard.centered.home');\n        d.resolve(r.data.token);\n      }, function() {\n        d.reject();\n      });\n\n      return d.promise;\n    };\n\n    var signinFB = function() {\n      //console.log(\"loginctrl\");\n      var d = $q.defer();\n\n      var doFbLogin = function(fb_response) {\n        //console.log('called');\n        var d = $q.defer();\n        r = fb_response;\n        if (r.status === 'connected') {\n          json = {\n            \"fb_access_token\": r.authResponse.accessToken\n          };\n          Restangular.service('fb-token').post(json).then(function(r) {\n            saveToken(r.data.token);\n            refreshProfile(); //Refresh session data here\n            //console.log(r);\n            d.resolve(r);\n          }, function(r) {\n            d.reject(r);\n          });\n        } else {\n          //console.log('reject');\n          d.reject();\n\n        }\n        return d.promise;\n      };\n\n      if(isCordova){\n        $cordovaFacebook.login(['public_profile', 'email']).then(function(r) {\n          console.log(r);\n          doFbLogin(r).then(function() {\n            d.resolve();\n          }, function(r) {\n            d.reject(r);\n          });\n        }, function(){\n          d.reject();\n        });\n      }else{\n        Facebook.login(function(r) {\n          //console.log(r);\n          doFbLogin(r).then(function() {\n            d.resolve();\n          }, function(r) {\n            d.reject(r);\n          });\n        });\n      }\n\n      return d.promise;\n    };\n\n    var logout = function() {\n      NotificationsService.unsubscribe();\n      tokenClaims = {};\n      delete $localStorage.token;\n      refreshProfile();\n      $state.go('web.app.login');\n    };\n\n    var resetProfile = function() {\n      user.authenticated = false;\n      user.id = null;\n      user.hash_id = null;\n      user.name = \"Guest\";\n      user.firstName = \"Guest\";\n      user.lastName = \"Guest\";\n      user.sex = null;\n      user.location = null;\n      user.email = null;\n      user.avatar = null;\n    };\n\n    return {\n      signup: signup,\n      signin: signin,\n      signinFB: signinFB,\n      logout: logout,\n      refreshProfile: refreshProfile,\n      resetProfile: resetProfile,\n      userProfile: user,\n    };\n  }\n]);\n\napp.factory('Me', ['Auth', 'Restangular', '$q', 'TokenService', function(Auth, Restangular, $q, TokenService) {\n\n  var uid = TokenService.token().sub;\n  //console.log(uid);\n\n  var me = Restangular.one('users', uid);\n\n  var sendPost = function(o) {\n    return Restangular.all('posts').post({\n      \"post\": o.post,\n      \"anonymous\": o.anonymous,\n      \"categories\": o.categories,\n      \"images\": o.images\n    });\n  };\n\n  return {\n    id: uid,\n    me: me,\n    authenticated: Auth.userProfile.authenticated,\n    favorites: me.all('favorites'),\n    profile: Auth.userProfile,\n    sendPost: sendPost\n\n  };\n}]);\n\napp.factory('PostService', ['Restangular', '$q', function(Restangular, $q) {\n\n  var posts = Restangular.all('posts');\n\n  var post = function(id) {\n    return Restangular.one('posts', id);\n  };\n\n  return {\n    post: post\n  };\n\n}]);\n\napp.factory('CommentService', ['Restangular', '$q', function(Restangular, $q) {\n\n  var posts = Restangular.all('comments');\n\n  var comment = function(id) {\n    return Restangular.one('comments', id);\n  };\n\n  return {\n    comment: comment\n  };\n\n}]);\n\napp.factory('SocialService', ['Facebook', 'Auth', function(Facebook, Auth) {\n\n\n  return {\n\n  };\n}]);\n\napp.factory('PChannels', function(TokenService, Pusher){\n\n  var notif_channel = Pusher.pusher.subscribe('private-notifications-' + TokenService.token().hash_id);\n\n  var notifications_subscribe = function(){\n    //var channel = Pusher.pusher.subscribe('private-notifications-' + TokenService.token().hash_id);\n    //notifications = channel;\n    notif_channel.subscribe('private-notifications-' + TokenService.token().hash_id);\n  };\n\n  var notifications = Pusher.pusher.subscribe('private-notifications-' + TokenService.token().hash_id);\n\n  return {\n    notifications: notifications,\n    notifications_subscribe: notifications_subscribe,\n    notifications_unsubscribe: function (){\n      return Pusher.pusher.unsubscribe('private-notifications-' + TokenService.token().hash_id);\n    }\n  };\n});\n\napp.factory('NotificationsService', function(TokenService, Pusher, $state, $stateParams, $rootScope, Restangular){\n\n  var n_chanell = null;\n\n  var m_notif = [];\n  var notifs = [];\n  var f_requests = [];\n\n  var getIndexById = function(arr, obj){\n    var count = arr.length;\n    for(var i = 0; i < count; i++){\n      if(arr[i].id == obj.id){\n        return i;\n      }\n    }\n    return -1;\n  };\n\n  var checkIfCurrentChat = function(chat){\n    if($state.current.name == \"web.app.dashboard.message\"){\n        var count = chat.users.length;\n\n        for(i = 0; i < count; i++){\n          if(chat.users[i].hash_id == $stateParams.user_id || chat.users[i].username == $stateParams.user_id){\n            return true;\n          }\n        }\n        return false;\n      }\n    };\n\n  var initPusher = function(){\n    if(!TokenService.token().hash_id)\n      return;\n\n    var n = Pusher.pusher.subscribe('private-notifications-' + TokenService.token().hash_id);\n    n_chanell = n;\n    n.bind('new_message', function(data) {\n      if(!checkIfCurrentChat(data)){\n        var idx = getIndexById(m_notif, data);\n        if(idx == -1){\n          m_notif.push(data);\n          if(!$rootScope.$$phase){\n            $rootScope.$digest();\n          }\n        }\n      }\n    });\n\n    n.bind('pusher:subscription_succeeded', function(status) {\n      Restangular.one('me').all('messages').all('unread').getList().then(\n        function(r){\n          var count = r.data.length;\n          m_notif.splice(0, r.data.length);//Clear the array first\n          for(var i = 0; i < count; i++){\n            //console.log(i, count);\n            //var idx = getIndexById(m_notif, r.data[i]);\n            //if(idx == -1){\n              m_notif.push(r.data[i]);//repopulate the array since its from the server\n            //}\n          }\n\n          if(!$rootScope.$$phase){\n            $rootScope.$digest();\n          }\n\n        }\n      );\n      Restangular.one('me').all('notifications').getList().then(\n        function(r){\n          var count = r.data.length;\n          notifs.splice(0, r.data.length);//Clear the array first\n          for(var i = 0; i < count; i++){\n              notifs.push(r.data[i]);//repopulate the array since its from the server\n          }\n\n          if(!$rootScope.$$phase){\n            $rootScope.$digest();\n          }\n\n        }\n      );\n      Restangular.one('me').all('friend_requests').getList().then(\n        function(r){\n          var count = r.data.length;\n          f_requests.splice(0, r.data.length);//Clear the array first\n          for(var i = 0; i < count; i++){\n              f_requests.push(r.data[i]);//repopulate the array since its from the server\n          }\n\n          if(!$rootScope.$$phase){\n            $rootScope.$digest();\n          }\n\n        }\n      );\n    });\n\n    n.bind('pusher:subscription_error', function(status) {\n      if(status == 408 || status == 503){\n        // retry?\n      }\n    });\n  };\n\n  var clearNotifications = function(chat_id){\n\n    Restangular.one('me').one('messages', chat_id).one('read').patch();\n\n    var idx = getIndexById(m_notif, chat_id);\n    if(idx >= 0){\n      m_notif.splice(idx, 1);\n    }\n  };\n\n  var unsubscribe = function (){\n    n_chanell.unsubscribe('private-notifications-' + TokenService.token().hash_id);\n  };\n\n  initPusher();\n\n  return {\n    MessageNotifications: m_notif,\n    Notifications: notifs,\n    FriendRequestNotifications: f_requests,\n    clearNotifications: clearNotifications,\n    unsubscribe: unsubscribe,\n    reInitPusher: initPusher\n  };\n});\n\napp.factory('UtilityService', function(){\n\n  var findHighestID = function(arr){\n    var count = arr.length;\n    //console.log(arr, count);\n    return arr[count - 1].id;\n  };\n\n  var findHighestTimestamp = function(arr){\n    var count = arr.length;\n    return arr[count - 1].created_at;\n  };\n\n  return {\n    findHighestID: findHighestID,\n    findHighestTimestamp: findHighestTimestamp\n  };\n});\n\napp.factory('FriendshipService', function(Restangular){\n\n    var acceptRequest = function(userID){\n        Restangular.one('me').all('friend_requests').post({\n            user_id: userID\n        });\n    };\n\n    var deleteRelationship = function(userID){\n        Restangular.one('me').one('friend_requests', userID).remove();\n    };\n\n\n    return {\n        acceptRequest: acceptRequest,\n        deleteRelationship: deleteRelationship\n    };\n});\n\napp.factory('EmojioneService', function(){\n    var emojione = window.emojione;\n    emojione.imagePathPNG = 'bower_components/emojione/assets/png/';\n\n    return {\n        emojione: emojione\n    };\n});\n"],"sourceRoot":"/source/"}